{% schema %}
{
  "name": "Engineered Layers",
  "settings": [
    {
      "type": "header",
      "content": "Section Colors"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#07231b"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#BCA588"
    },
    {
      "type": "color",
      "id": "line_color",
      "label": "Line Color",
      "default": "#A3835F"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Layer Title Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "desc_color",
      "label": "Layer Description Color",
      "default": "#B0B0B0"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "Engineered From The Inside Out"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 2,
      "unit": "px",
      "label": "Padding Top",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 80
    }
  ],
  "blocks": [
    {
      "type": "layer",
      "name": "Layer",
      "limit": 6,
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Layer Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Layer Name"
        },
        {
          "type": "text",
          "id": "desc",
          "label": "Description",
          "default": "Layer details here"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Engineered Layers",
      "blocks": [
        {
          "type": "layer",
          "settings": {
            "title": "Pure Titanium With SlipScale Technology",
            "desc": "Non-toxic. Non-stick."
          }
        },
        {
          "type": "layer",
          "settings": {
            "title": "Third Recycled Aluminum Core",
            "desc": "Pushes heat out evenly to all edges"
          }
        },
        {
          "type": "layer",
          "settings": {
            "title": "Second Recycled Aluminum Core",
            "desc": "Stabilizes internal heat"
          }
        },
        {
          "type": "layer",
          "settings": {
            "title": "First Recycled Aluminum Core",
            "desc": "Pulls heat in fast"
          }
        },
        {
          "type": "layer",
          "settings": {
            "title": "Induction-Ready Stainless Steel",
            "desc": "Adds durability & magnetic conductivity"
          }
        }
      ]
    }
  ]
}
{% endschema %}

<section id="ieo-template--{{ section.id }}" class="ieo" style="--st: 220ms;">
  <div class="ieo-inner">
    {% if section.settings.heading != blank %}
      <h2 class="ieo-title">{{ section.settings.heading }}</h2>
    {% endif %}

    <div class="ieo-layout">
      
      <div class="ieo-visual">
        {% for block in section.blocks %}
          
          {% assign i = forloop.index0 %}
          {% assign z = 100 | minus: i %}
          
          {% comment %} 
            Offset Logic:
            Desktop Gap: 130px
            Mobile Gap: 85px (Tightened for mobile screens)
          {% endcomment %}
          
          {% assign offset_val = i | times: 130 %}
          {% assign offset_val_m = i | times: 85 %}

          {% if block.settings.image != blank %}
            <img 
              src="{{ block.settings.image | image_url: width: 1000 }}" 
              class="ieo-layer from-left {% if forloop.first %}ieo-pan{% endif %}" 
              data-step="{{ forloop.index }}"
              style="--off: {{ offset_val }}px; --off-m: {{ offset_val_m }}px; --i: {{ i }}; z-index: {{ z }};"
              alt="{{ block.settings.title | escape }}"
              loading="lazy"
              width="600"
              height="auto"
            >
          {% else %}
             <div class="ieo-layer from-left placeholder-layer" 
                  data-step="{{ forloop.index }}"
                  style="--off: {{ offset_val }}px; --off-m: {{ offset_val_m }}px; --i: {{ i }}; z-index: {{ z }}; background: #4a4a4a;">
             </div>
          {% endif %}

        {% endfor %}
      </div>

      <div class="ieo-right">
        <ul class="ieo-list">
          {% for block in section.blocks %}
            <li class="ieo-li" data-step="{{ forloop.index }}" style="--i: {{ forloop.index0 }};" {{ block.shopify_attributes }}>
              <span class="ieo-line"></span>
              <div class="ieo-text">
                {% if block.settings.title != blank %}
                  <div class="ieo-li-title">{{ block.settings.title }}</div>
                {% endif %}
                
                {% if block.settings.desc != blank %}
                  <div class="ieo-li-desc">{{ block.settings.desc }}</div>
                {% endif %}
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>

    </div>
  </div>
</section>

<style>
  /* --- VARIABLES --- */
  #ieo-template--{{ section.id }} {
    background-color: {{ section.settings.bg_color }};
    --heading-color: {{ section.settings.heading_color }};
    --line-color: {{ section.settings.line_color }};
    --title-color: {{ section.settings.title_color }};
    --desc-color: {{ section.settings.desc_color }};
    --pt: {{ section.settings.padding_top }}px;
    --pb: {{ section.settings.padding_bottom }}px;
  }

  #ieo-template--{{ section.id }}.ieo {
    color: #fff;
    overflow: hidden;
  }

  #ieo-template--{{ section.id }} .ieo-inner {
    max-width: 1400px;
    margin: 0 auto;
    padding: var(--pt) 24px var(--pb) 24px;
  }

  #ieo-template--{{ section.id }} .ieo-title {
    margin: 0 0 60px;
    font-family: 'Neue Montreal', sans-serif;
    color: var(--heading-color);
    font-size: 48px;
    font-weight: 400;
    line-height: 1.3;
    letter-spacing: 1.92px;
    text-transform: capitalize;
    text-align: center;
  }

  /* --- GRID LAYOUT (DESKTOP) --- */
  #ieo-template--{{ section.id }} .ieo-layout {
    display: grid;
    grid-template-columns: 1fr 1fr; /* 50% Image | 50% Text */
    gap: 40px;
    align-items: flex-start;
    position: relative;
  }

  /* --- IMAGES (Left) --- */
  #ieo-template--{{ section.id }} .ieo-visual {
    position: relative;
    width: 100%;
    /* Height must accommodate the total spread of layers */
    min-height: 800px; 
    max-width: 600px;
    margin: 0 auto;
  }

  #ieo-template--{{ section.id }} .ieo-layer {
    position: absolute;
    left: 0; 
    right: 0;
    margin: 0 auto;
    width: 80%;
    max-width: 500px;
    height: auto;
    display: block;
    opacity: 0;
    
    /* Initial State (Collapsed) */
    top: 50px; 
    transform: translateY(0px) scale(0.95);
    
    transition: transform 0.8s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.8s ease;
    will-change: transform, opacity;
    filter: drop-shadow(0 15px 25px rgba(0, 0, 0, 0.5));
    
    /* Staggered Delay */
    transition-delay: calc(var(--i) * 200ms);
  }

  /* Top Pan Specific Position */
  #ieo-template--{{ section.id }} .ieo-layer.ieo-pan {
    top: -50px; 
    z-index: 1000;
  }

  /* Placeholder for testing */
  #ieo-template--{{ section.id }} .placeholder-layer {
    height: 60px;
    border-radius: 50%;
  }

  /* Active State (Expanded) */
  #ieo-template--{{ section.id }} .ieo-layer.is-on {
    opacity: 1;
    transform: translateY(var(--off, 0px)) scale(1);
  }

  /* --- TEXT LIST (Right) --- */
  #ieo-template--{{ section.id }} .ieo-right {
    padding-top: 50px; /* Align first text with first image gap */
  }

  #ieo-template--{{ section.id }} .ieo-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    /* Gap must approximate Image Offset (130px) to stay aligned */
    gap: 75px; 
  }

  #ieo-template--{{ section.id }} .ieo-li {
    display: flex;
    align-items: center;
    gap: 16px;
    opacity: 0;
    transform: translateX(30px);
    transition: transform 0.8s ease, opacity 0.8s ease;
    transition-delay: calc(var(--i) * 200ms);
    position: relative;
    min-height: 55px; /* Ensures text block has substance */
  }

  #ieo-template--{{ section.id }} .ieo-li.is-on {
    opacity: 1;
    transform: translateX(0);
  }

  #ieo-template--{{ section.id }} .ieo-line {
    background: var(--line-color);
    height: 1px;
    width: 80px;
    flex-shrink: 0;
    display: block;
  }

  #ieo-template--{{ section.id }} .ieo-text {
    flex-grow: 1;
  }

  #ieo-template--{{ section.id }} .ieo-li-title {
    font-family: 'Neue Montreal', sans-serif;
    color: var(--title-color);
    font-size: 24px;
    font-weight: 500;
    line-height: 1.3;
    text-transform: capitalize;
  }

  #ieo-template--{{ section.id }} .ieo-li-desc {
    margin-top: 6px;
    font-family: 'Neue Montreal', sans-serif;
    color: var(--desc-color);
    font-size: 16px;
    line-height: 1.4;
  }

  /* --- MOBILE FIX (Side by Side) --- */
  @media (max-width: 768px) {
    #ieo-template--{{ section.id }} .ieo-inner {
      padding-top: 40px;
      padding-bottom: 40px;
      padding-left: 10px;
      padding-right: 10px;
    }

    #ieo-template--{{ section.id }} .ieo-title {
      font-size: 28px;
      margin-bottom: 30px;
    }

    /* Keep SIDE BY SIDE layout */
    #ieo-template--{{ section.id }} .ieo-layout {
      grid-template-columns: 40% 60%; /* Image Left (40%), Text Right (60%) */
      gap: 10px;
    }

    #ieo-template--{{ section.id }} .ieo-visual {
      /* Height must accommodate 5-6 layers * 85px gap */
      min-height: 550px; 
      margin: 0;
    }

    #ieo-template--{{ section.id }} .ieo-layer {
      width: 120%; /* Make image slightly wider than its column to look big */
      left: -10%; /* Center it roughly */
      top: 0;
      /* Animation Reset */
      transform: translateY(0px) scale(0.95);
    }
    
    #ieo-template--{{ section.id }} .ieo-layer.ieo-pan {
      top: -20px;
    }

    #ieo-template--{{ section.id }} .ieo-layer.is-on {
      /* Use Mobile Offset */
      transform: translateY(var(--off-m, 0px)) scale(1);
    }

    /* Text Adjustments */
    #ieo-template--{{ section.id }} .ieo-right {
      padding-top: 0;
    }

    #ieo-template--{{ section.id }} .ieo-list {
      /* Vertical gap must match Image Mobile Offset (85px) minus text height */
      gap: 40px; 
      justify-content: flex-start;
      padding-top: 10px;
    }

    #ieo-template--{{ section.id }} .ieo-line {
      width: 15px; /* Small line */
      margin-right: 5px;
    }
    
    #ieo-template--{{ section.id }} .ieo-li {
      gap: 5px;
      min-height: 45px; /* Consistent height anchor */
    }

    #ieo-template--{{ section.id }} .ieo-li-title {
      font-size: 14px;
      line-height: 1.2;
    }

    #ieo-template--{{ section.id }} .ieo-li-desc {
      font-size: 11px;
      margin-top: 3px;
      line-height: 1.3;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const sec = document.getElementById('ieo-template--{{ section.id }}');
    if (!sec) return;

    // Use Intersection Observer for scroll animation
    const observerOptions = {
      root: null,
      rootMargin: '0px',
      threshold: 0.1 // Trigger quickly on mobile
    };

    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const layers = sec.querySelectorAll('.ieo-layer');
          const listItems = sec.querySelectorAll('.ieo-li');

          layers.forEach(el => el.classList.add('is-on'));
          listItems.forEach(el => el.classList.add('is-on'));

          observer.disconnect();
        }
      });
    }, observerOptions);

    observer.observe(sec);
  });
</script>