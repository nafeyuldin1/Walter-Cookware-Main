<section id="MainProduct-{{ section.id }}" class="section-{{ section.id }}-padding gradient color-{{ section.settings.color_scheme }}" data-section="{{ section.id }}">
  
  {{ 'section-main-product.css' | asset_url | stylesheet_tag }}
  {{ 'component-price.css' | asset_url | stylesheet_tag }}
  {{ 'component-loading-spinner.css' | asset_url | stylesheet_tag }}

  {% unless product.has_only_default_variant %}
    {{ 'component-product-variant-picker.css' | asset_url | stylesheet_tag }}
  {% endunless %}

  {%- style -%}
    /* --- 1. CORE THEME & LAYOUT --- */
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
      padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
      background-color: #121212 !important;
      color: #ffffff !important;
    }

    @media screen and (min-width: 750px) {
      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top }}px;
        padding-bottom: {{ section.settings.padding_bottom }}px;
      }
    }

    /* Headings & Text */
    #MainProduct-{{ section.id }} h1, 
    #MainProduct-{{ section.id }} .product__title,
    #MainProduct-{{ section.id }} .price-item { color: #ffffff !important; }
    #MainProduct-{{ section.id }} .product__text, .product__description { color: #B0B0B0 !important; }

    /* --- 2. VARIANT PICKER FIX (No Repetition & No White Boxes) --- */
    
    /* 1. Hide the "Default Title" label and button completely */
    label[for*="Default-Title"], 
    input[value="Default Title"] + label,
    .product-form__input option[value="Default Title"] {
      display: none !important;
    }

    /* 2. Styling the valid variant pills */
    #MainProduct-{{ section.id }} .product-form__input input[type='radio'] + label {
      background-color: transparent !important;
      color: #ffffff !important;
      border: 1px solid #454545 !important;
      border-radius: 4px;
      padding: 12px 24px;
      margin: 0 8px 8px 0;
      display: inline-block;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 14px;
    }

    /* 3. Selected variant style */
    #MainProduct-{{ section.id }} .product-form__input input[type='radio']:checked + label {
      background-color: #ffffff !important;
      color: #000000 !important;
      border-color: #ffffff !important;
    }

    /* --- 3. CUSTOM BLOCKS --- */
    .benefits-grid { margin: 20px 0; border-top: 1px solid #333; padding-top: 20px; }
    .benefits-grid__list { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .benefits-grid__item { display: flex; align-items: center; gap: 10px; }
    .benefits-grid__text { font-size: 12px; color: #b0b0b0; }

    .shipbar { 
      margin: 20px 0; background: #03231A; border-radius: 8px; 
      padding: 15px; display: flex; align-items: center; gap: 15px; 
    }
    .shipbar__text { font-size: 12px; color: #D2F1E3; line-height: 1.4; }

    /* Tabs */
    .pit-container { margin-top: 30px; border-top: 1px solid #454545; }
    .pit-tabs { display: flex; border-bottom: 1px solid #454545; }
    .pit-tab { 
      flex: 1; padding: 15px; background: transparent; border: none; 
      color: #666; cursor: pointer; font-weight: bold; border-bottom: 2px solid transparent; 
    }
    .pit-tab.is-active { color: #fff; border-bottom-color: #fff; }
    .pit-panel { display: none; padding: 20px 0; color: #B0B0B0; font-size: 14px; }
    .pit-panel.is-active { display: block; animation: fadeIn 0.4s; }

    /* Upsell */
    .upsell-card { 
      background: #1a1a1a; border: 1px solid #333; border-radius: 12px; 
      padding: 15px; display: flex; gap: 15px; align-items: center; margin-top:15px; 
    }

    /* Sticky Button */
    .sticky-cta { 
      position: fixed; z-index: 99; bottom: 20px; right: 20px; 
      background: #1a1a1a; padding: 10px 20px; border-radius: 50px; 
      display: flex; align-items: center; gap: 15px; 
      border: 1px solid #333; transform: translateY(200%); transition: 0.3s;
    }
    .sticky-cta.is-visible { transform: translateY(0); }
    .sticky-cta button { background: #fff; color: #000; border: none; padding: 8px 20px; border-radius: 25px; font-weight: bold; cursor: pointer; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  {%- endstyle -%}

  <div class="page-width">
    <div class="product grid grid--1-col grid--2-col-tablet">
      <div class="grid__item product__media-wrapper">
        {% render 'product-media-gallery', variant_images: variant_images %}
      </div>
      
      <div class="product__info-wrapper grid__item">
        <product-info id="ProductInfo-{{ section.id }}" class="product__info-container" data-section="{{ section.id }}" data-url="{{ product.url }}">
          {%- assign product_form_id = 'product-form-' | append: section.id -%}

          {%- for block in section.blocks -%}
            {%- case block.type -%}
              {%- when 'title' -%}
                <h1 class="product__title" {{ block.shopify_attributes }}>{{ product.title | escape }}</h1>
              {%- when 'price' -%}
                <div id="price-{{ section.id }}" {{ block.shopify_attributes }}>
                  {%- render 'price', product: product, use_variant: true, show_badges: true, price_class: 'price--large' -%}
                </div>
              {%- when 'variant_picker' -%}
                {% render 'product-variant-picker', product: product, block: block, product_form_id: product_form_id %}
                <button type="button" class="size-guide-trigger" style="background:none; border:none; color:#888; text-decoration:underline; cursor:pointer; font-size:12px; margin-top:10px;">üìè Size Guide</button>
              {%- when 'buy_buttons' -%}
                {%- render 'buy-buttons', block: block, product: product, product_form_id: product_form_id, section_id: section.id -%}
                <div class="shipbar">
                   <div style="font-size: 20px;">üöö</div>
                   <div class="shipbar__text"><strong>Free Shipping & 30-Day Returns</strong><br>Your order is protected by our lifetime warranty.</div>
                </div>
              {%- when 'description' -%}
                <div class="product__description rte" {{ block.shopify_attributes }}>{{ product.description }}</div>
            {%- endcase -%}
          {%- endfor -%}

          <div class="pit-container">
            <div class="pit-tabs">
              <button class="pit-tab is-active" data-target="panel-desc">Details</button>
              <button class="pit-tab" data-target="panel-health">Benefits</button>
            </div>
            <div id="panel-desc" class="pit-panel is-active">{{ product.description | truncatewords: 50 }}</div>
            <div id="panel-health" class="pit-panel"><p>Our titanium is naturally non-toxic and non-stick. Safe for all stovetops.</p></div>
          </div>
        </product-info>
      </div>
    </div>
  </div>
</section>

<div id="sticky-cta-wrapper" class="sticky-cta">
  <div style="color:#fff; font-size: 13px; font-weight: bold;">{{ product.title | truncate: 15 }}</div>
  <button id="sticky-add-to-cart">ADD TO CART</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const sectionId = "{{ section.id }}";
  
  // 1. Force Remove any duplicate Default Titles that JS might inject
  document.querySelectorAll('.product-form__input').forEach(input => {
    if(input.innerText.includes('Default Title')) {
       input.style.display = 'none';
    }
  });

  // 2. Tabs Logic
  document.querySelectorAll('.pit-tab').forEach(tab => {
    tab.addEventListener('click', function() {
      const container = this.closest('.pit-container');
      container.querySelectorAll('.pit-tab, .pit-panel').forEach(el => el.classList.remove('is-active'));
      this.classList.add('is-active');
      document.getElementById(this.dataset.target).classList.add('is-active');
    });
  });

  // 3. Sticky Button Logic
  window.addEventListener('scroll', () => {
    const sticky = document.getElementById('sticky-cta-wrapper');
    const mainBtn = document.querySelector('.product-form__submit');
    if(mainBtn && sticky) {
      if(mainBtn.getBoundingClientRect().bottom < 0) sticky.classList.add('is-visible');
      else sticky.classList.remove('is-visible');
    }
  });

  document.getElementById('sticky-add-to-cart')?.addEventListener('click', () => {
    document.querySelector('.product-form__submit')?.click();
  });
});
</script>

{% schema %}
{
  "name": "Fixed Product Section",
  "tag": "section",
  "blocks": [
    {"type": "title", "name": "Title", "limit": 1},
    {"type": "price", "name": "Price", "limit": 1},
    {"type": "variant_picker", "name": "Variant Picker", "limit": 1},
    {"type": "buy_buttons", "name": "Buy Buttons", "limit": 1},
    {"type": "description", "name": "Description", "limit": 1}
  ],
  "settings": [
    {"type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Top Padding", "default": 36},
    {"type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Bottom Padding", "default": 36}
  ]
}
{% endschema %}