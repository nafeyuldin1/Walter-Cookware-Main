<section id="MainProduct-{{ section.id }}" class="section-{{ section.id }}-padding gradient color-{{ section.settings.color_scheme }}" data-section="{{ section.id }}">
  {{ 'section-main-product.css' | asset_url | stylesheet_tag }}
  {{ 'component-accordion.css' | asset_url | stylesheet_tag }}
  {{ 'component-price.css' | asset_url | stylesheet_tag }}
  {{ 'component-slider.css' | asset_url | stylesheet_tag }}
  {{ 'component-rating.css' | asset_url | stylesheet_tag }}
  {{ 'component-loading-spinner.css' | asset_url | stylesheet_tag }}

  {%- style -%}
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
      padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
      background-color: #121212 !important;
      color: #ffffff !important;
    }
    @media screen and (min-width: 750px) {
      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top }}px;
        padding-bottom: {{ section.settings.padding_bottom }}px;
      }
    }
    h1, h2, h3, .product__title h1 { color: #ffffff !important; }
    .product__text, .product__description, .price-item { color: #B0B0B0 !important; }
    .benefits-grid { margin: 20px 0; border-top: 1px solid #333; padding-top: 20px; }
    .benefits-grid__list { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .benefits-grid__item { display: flex; align-items: center; gap: 10px; font-size: 12px; }
    .pit-tabs { display: flex; border-bottom: 1px solid #454545; margin: 20px 0; }
    .pit-tab { flex: 1; padding: 15px; background: transparent; border: none; color: #B0B0B0; cursor: pointer; border-bottom: 2px solid transparent; }
    .pit-tab.is-active { color: #fff; border-bottom-color: #fff; }
    .pit-panel { display: none; color: #B0B0B0; padding: 15px 0; line-height: 1.6; }
    .pit-panel.is-active { display: block; }
    .sticky-cta { position: fixed; z-index: 99; bottom: 20px; right: 20px; background: #1a1a1a; padding: 10px; border-radius: 12px; display: flex; align-items: center; gap: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform: translateY(200%); transition: transform 0.3s ease; border: 1px solid #333; }
    .sticky-cta.is-visible { transform: translateY(0); }
    .sticky-cta img { width: 50px; height: 50px; border-radius: 6px; }
    .sticky-cta button { background: #fff; color: #000; border: none; padding: 10px 20px; font-weight: bold; border-radius: 6px; cursor: pointer; }
    .sg-modal { position: fixed; inset: 0; z-index: 10000; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.7); backdrop-filter: blur(2px); }
    .sg-panel { background: #fff; padding: 30px; border-radius: 12px; width: 90%; max-width: 500px; position: relative; color: #000; }
  {%- endstyle -%}

  <div class="page-width">
    <div class="product grid grid--1-col grid--2-col-tablet">
      <div class="grid__item product__media-wrapper">
        {% render 'product-media-gallery' %}
      </div>
      <div class="product__info-wrapper grid__item">
        <product-info id="ProductInfo-{{ section.id }}" data-section="{{ section.id }}" data-url="{{ product.url }}">
          {%- assign product_form_id = 'product-form-' | append: section.id -%}
          {%- for block in section.blocks -%}
            {%- case block.type -%}
              {%- when 'title' -%}<h1 class="product__title">{{ product.title | escape }}</h1>
              {%- when 'price' -%}
                <div id="price-{{ section.id }}">{% render 'price', product: product, use_variant: true, show_badges: true %}</div>
              {%- when 'variant_picker' -%}
                {% render 'product-variant-picker', product: product, block: block, product_form_id: product_form_id %}
                <button type="button" class="size-guide-trigger" style="background:none; border:none; color:#fff; text-decoration:underline; cursor:pointer; margin-top:10px;">üìè Size Guide</button>
              {%- when 'buy_buttons' -%}
                {% render 'buy-buttons', block: block, product: product, product_form_id: product_form_id, section_id: section.id %}
            {%- endcase -%}
          {%- endfor -%}

          <div class="pit-tabs">
            <button class="pit-tab is-active" data-target="panel-desc">Description</button>
            <button class="pit-tab" data-target="panel-health">Health</button>
          </div>
          <div id="panel-desc" class="pit-panel is-active">{{ product.description }}</div>
          <div id="panel-health" class="pit-panel">Naturally non-toxic titanium.</div>

          <div class="upsell-section">
            <h3 style="color:#fff; font-size:16px;">Complete Your Kitchen</h3>
            <div class="upsell-card">
              <div style="width:50px; height:50px; background:#333; border-radius:5px;"></div>
              <div style="flex:1; color:#000;"><strong>Titanium Set</strong><br>$199</div>
              <button class="js-upsell-add" data-variant-id="{{ product.selected_or_first_available_variant.id }}" style="background:#A3835F; color:#fff; border:none; padding:5px 15px; border-radius:4px; cursor:pointer;">Add</button>
            </div>
          </div>
        </product-info>
      </div>
    </div>
  </div>
</section>

<div id="sticky-cta-wrapper" class="sticky-cta">
  <img src="{{ product.featured_image | image_url: width: 100 }}">
  <div style="color:#fff;">
    <div style="font-weight:bold; font-size:14px;">{{ product.title | truncate: 20 }}</div>
    <div style="color:#ff2422; font-size:11px;">‚ö†Ô∏è LOW STOCK</div>
  </div>
  <button id="sticky-atc-trigger">ADD TO CART</button>
</div>

<div id="sg-modal" class="sg-modal" hidden>
  <div class="sg-panel">
    <button onclick="document.getElementById('sg-modal').hidden = true" style="float:right; border:none; background:none; font-size:20px; cursor:pointer;">&times;</button>
    <h3>Size Guide</h3>
    <p>Standard: 10.2" | Large: 11"</p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const mainSubmitBtn = document.querySelector('.product-form__submit');
  
  // 1. Sticky Button Click
  document.getElementById('sticky-atc-trigger')?.addEventListener('click', () => {
    mainSubmitBtn?.click();
  });

  // 2. Scroll Visibility
  window.addEventListener('scroll', () => {
    const cta = document.getElementById('sticky-cta-wrapper');
    if(mainSubmitBtn && cta) {
      if(mainSubmitBtn.getBoundingClientRect().bottom < 0) cta.classList.add('is-visible');
      else cta.classList.remove('is-visible');
    }
  });

  // 3. Tabs
  document.querySelectorAll('.pit-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.pit-tab, .pit-panel').forEach(el => el.classList.remove('is-active'));
      tab.classList.add('is-active');
      document.getElementById(tab.dataset.target).classList.add('is-active');
    });
  });

  // 4. Size Guide
  document.querySelector('.size-guide-trigger')?.addEventListener('click', () => {
    document.getElementById('sg-modal').hidden = false;
  });

  // 5. Upsell Add Logic
  document.querySelectorAll('.js-upsell-add').forEach(btn => {
    btn.addEventListener('click', function() {
      const vId = this.dataset.variantId;
      const formData = { 'items': [{ 'id': vId, 'quantity': 1 }] };
      
      fetch(window.Shopify.routes.root + 'cart/add.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      })
      .then(response => response.json())
      .then(() => {
        // Trigger Drawer Open
        const cartDrawer = document.querySelector('cart-drawer');
        if (cartDrawer) {
          // Dawn standard way to refresh drawer
          fetch(`${routes.cart_url}?section_id=cart-drawer`)
            .then(res => res.text())
            .then(html => {
              const inner = new DOMParser().parseFromString(html, 'text/html').querySelector('#CartDrawer').innerHTML;
              document.querySelector('#CartDrawer').innerHTML = inner;
              cartDrawer.open();
            });
        }
      });
    });
  });
});
</script>

{% schema %}
{
  "name": "Main Product Custom",
  "tag": "section",
  "blocks": [
    {"type": "title", "name": "Title", "limit": 1},
    {"type": "price", "name": "Price", "limit": 1},
    {"type": "variant_picker", "name": "Variant Picker", "limit": 1},
    {"type": "buy_buttons", "name": "Buy Buttons", "limit": 1}
  ],
  "settings": [
    {"type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Top Padding", "default": 36},
    {"type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Bottom Padding", "default": 36}
  ]
}
{% endschema %}