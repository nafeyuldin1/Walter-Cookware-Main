<link rel="stylesheet" href="{{ 'component-list-menu.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-search.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-menu-drawer.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-cart-notification.css' | asset_url }}" media="print" onload="this.media='all'">

<style>
  /* --- GENERAL HEADER STYLES --- */
  .header { padding: 10px 20px; background: {{ section.settings.bg_color }}; }
  .header__heading-logo { max-width: {{ section.settings.logo_width }}px; height: auto; }
  .header__icons { display: flex; align-items: center; gap: 15px; }
  
  @media screen and (min-width: 990px) {
    .header { padding: 20px 40px; }
  }

  /* --- DESKTOP CATEGORY STRIP (TABS) --- */
  .cat-strip-wrapper { border-bottom: 1px solid #e0e0e0; background: #fff; }
  .cat-strip { display: flex; justify-content: center; gap: 30px; overflow-x: auto; padding: 0 20px; }
  .cat-strip__item {
    background: none; border: none; padding: 15px 0;
    font-size: 13px; font-weight: 600; color: #333; text-transform: uppercase; cursor: pointer;
    border-bottom: 2px solid transparent; transition: all 0.3s; white-space: nowrap;
  }
  .cat-strip__item:hover, .cat-strip__item.is-active { border-bottom-color: #000; color: #000; }

  /* --- MEGA MENU PORTALS --- */
  .cat-portals { position: absolute; top: 100%; left: 0; width: 100%; background: #fff; z-index: 999; border-bottom: 1px solid #ddd; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
  .cat-portal { display: none; max-width: 1400px; margin: 0 auto; padding: 40px; animation: fadeIn 0.3s ease; }
  .cat-portal[aria-hidden="false"] { display: flex; }
  
  .cat-portal__left { width: 25%; padding-right: 40px; border-right: 1px solid #eee; display: flex; flex-direction: column; justify-content: space-between; }
  .cat-portal__title { font-size: 24px; margin-bottom: 10px; font-weight: 700; }
  .cat-portal__link { text-decoration: underline; color: #555; font-size: 14px; display: block; margin-bottom: 20px; }
  
  /* Endorse/Review Box */
  .cat-portal__endorse { background: #f9f9f9; padding: 15px; border-radius: 8px; display: flex; align-items: center; gap: 15px; margin-top: auto; }
  .endorse__avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
  .endorse__name { font-weight: bold; font-size: 12px; margin-bottom: 4px; }
  .endorse__stars svg { width: 10px; height: 10px; fill: #B57C46; }

  /* Product Grid */
  .cat-portal__grid { width: 75%; padding-left: 40px; display: flex; gap: 20px; }
  .cat-prod { width: 33.33%; }
  .cat-prod__media { position: relative; display: block; border-radius: 8px; overflow: hidden; margin-bottom: 10px; }
  .cat-prod__media img { width: 100%; height: auto; transition: transform 0.3s; }
  .cat-prod__media:hover img { transform: scale(1.05); }
  .cat-prod__sale-badge { position: absolute; top: 10px; left: 10px; background: #932933; color: white; padding: 4px 8px; font-size: 11px; border-radius: 4px; font-weight: bold; }
  .cat-prod__title p { font-weight: 600; margin: 5px 0; color: #000; }
  .cat-prod_cmp-price { text-decoration: line-through; color: #999; margin-right: 5px; font-size: 14px; }
  .cat-prod_price { font-weight: bold; color: #333; }

  /* --- MOBILE MENU DRAWER (COMPETITOR STYLE) --- */
  .mm { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; pointer-events: none; }
  .mm.is-open { pointer-events: auto; }
  .mm__scrim { position: absolute; inset: 0; background: rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.3s; }
  .mm.is-open .mm__scrim { opacity: 1; }
  
  .mm__panel { 
    position: absolute; top: 0; left: 0; bottom: 0; width: 85%; max-width: 400px; 
    background: #fff; transform: translateX(-100%); transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
    display: flex; flex-direction: column; overflow: hidden;
  }
  .mm.is-open .mm__panel { transform: translateX(0); }

  /* Mobile Top Bar */
  .mm__top { height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-bottom: 1px solid #eee; }
  .mm__close svg, .mm2__back svg { width: 24px; height: 24px; cursor: pointer; }
  .mm2__back { display: none; background: none; border: none; }
  
  /* Mobile Steps Container */
  .mm__steps { flex: 1; position: relative; overflow: hidden; }
  .mm__step { 
    position: absolute; inset: 0; overflow-y: auto; background: #fff; 
    transition: transform 0.3s ease; padding: 20px;
  }
  .mm__step--2 { transform: translateX(100%); z-index: 2; }
  
  /* Active State for Step 2 */
  .mm-panel--step2 .mm__step--1 { transform: translateX(-20%); opacity: 0.5; }
  .mm-panel--step2 .mm__step--2 { transform: translateX(0); }
  .mm-panel--step2 .mm2__back { display: block; }
  .mm-panel--step2 .mm__brand { display: none; }

  /* Mobile Category List */
  .mm-cat__btn { 
    display: flex; align-items: center; width: 100%; padding: 15px 0; 
    background: none; border: none; border-bottom: 1px solid #f0f0f0; text-align: left; cursor: pointer;
  }
  .mm-cat__icon img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; margin-right: 15px; }
  .mm-cat__title { flex: 1; font-weight: 600; font-size: 15px; color: #000; text-transform: uppercase; }

  /* Mobile Product List (Step 2) */
  .mm2-item { display: flex; gap: 15px; margin-bottom: 20px; text-decoration: none; color: inherit; }
  .mm2-item__img img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; }
  .mm2-item__title { font-weight: 600; font-size: 14px; line-height: 1.3; }
  .mm2-item__sub { font-size: 12px; color: #666; margin-top: 5px; display: block; }

  /* Footer Links in Mobile Menu */
  .mm__footer { padding: 20px; border-top: 1px solid #eee; background: #f9f9f9; }
  .mm__footer-link { display: block; padding: 10px 0; font-weight: 500; color: #333; text-decoration: none; }

  /* Utilities */
  .small-hide { display: none; }
  @media screen and (min-width: 990px) { .small-hide { display: block; } .medium-hide { display: none; } }
  .hidden { display: none !important; }
  
  @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
</style>

<sticky-header class="header-wrapper">
  <header class="header page-width">
    
    <button class="header__icon header__icon--menu medium-hide" type="button" aria-label="Menu" onclick="openMobileMenu()">
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 23H28M4 16H28M4 9H28"/></svg>
    </button>

    <h1 class="header__heading">
      <a href="{{ routes.root_url }}" class="header__heading-link">
        {%- if section.settings.logo != blank -%}
          <img src="{{ section.settings.logo | image_url: width: section.settings.logo_width }}" 
               alt="{{ shop.name }}" 
               width="{{ section.settings.logo_width }}" 
               height="{{ section.settings.logo_width | divided_by: section.settings.logo.aspect_ratio }}" 
               class="header__heading-logo">
        {%- else -%}
          <span>{{ shop.name }}</span>
        {%- endif -%}
      </a>
    </h1>

    <nav class="header__inline-menu small-hide">
      </nav>

    <div class="header__icons">
      <a href="{{ routes.search_url }}" class="header__icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg></a>
      <a href="{{ routes.cart_url }}" class="header__icon" id="cart-icon-bubble">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M6 6h15l-1.68 7.57a2.5 2.5 0 01-2.44 1.93H8.35a2.5 2.5 0 01-2.45-1.9L4 6H1"/></svg>
        {%- if cart.item_count > 0 -%}<span class="cart-count">{{ cart.item_count }}</span>{%- endif -%}
      </a>
    </div>
  </header>

  {%- if section.blocks.size > 0 -%}
  <div class="cat-strip-wrapper small-hide">
    <div class="cat-strip">
      {%- for block in section.blocks -%}
        {%- if block.type == 'mega_menu' -%}
          <button class="cat-strip__item" data-key="tab-{{ block.id }}">{{ block.settings.tab_title }}</button>
        {%- endif -%}
      {%- endfor -%}
    </div>

    <div id="cat-portals-container" class="cat-portals" hidden>
      {%- for block in section.blocks -%}
        {%- if block.type == 'mega_menu' -%}
          <div class="cat-portal" data-key="tab-{{ block.id }}" aria-hidden="true">
            <div class="cat-portal__left">
              <div>
                <div class="cat-portal__title">{{ block.settings.tab_title }}</div>
                <a href="{{ block.settings.link_url }}" class="cat-portal__link">{{ block.settings.link_text }}</a>
                <div style="width: 50px; height: 2px; background: #000; margin-bottom: 15px;"></div>
                <div class="rte">{{ block.settings.description }}</div>
              </div>
              {%- if block.settings.review_text != blank -%}
              <div class="cat-portal__endorse">
                {% if block.settings.reviewer_image %}<img src="{{ block.settings.reviewer_image | image_url: width: 100 }}" class="endorse__avatar">{% endif %}
                <div>
                   <div class="endorse__name">{{ block.settings.reviewer_name }}</div>
                   <div class="endorse__stars">
                     {% for i in (1..5) %}<svg viewBox="0 0 14 14"><path d="M14 5.5c0 .1-.1.2-.2.3L10.7 8.9l.7 4.2c0 .1 0 .2 0 .2 0 .1-.1.1-.2.1-.1 0-.2-.1-.3-.2l-3.8-2-3.8 2c-.1.1-.2.1-.3.2h-.1c-.1 0-.1-.1-.1-.2l.7-4.2L.2 5.8c-.1-.1-.1-.2-.1-.3 0-.2.2-.3.5-.3l4.2-.6L6.6.7c.1-.2.2-.3.4-.3s.3.1.4.3l1.9 4.2 4.2.6c.3 0 .5.1.5.3Z"></path></svg>{% endfor %}
                   </div>
                   <div style="font-size: 11px; margin-top:2px;">{{ block.settings.review_text }}</div>
                </div>
              </div>
              {%- endif -%}
            </div>
            <div class="cat-portal__grid">
              {%- if block.settings.collection != blank -%}
                {%- for product in collections[block.settings.collection].products limit: 3 -%}
                  <a href="{{ product.url }}" class="cat-prod">
                    <div class="cat-prod__media">
                      <img src="{{ product.featured_image | image_url: width: 400 }}" loading="lazy">
                      {% if product.compare_at_price > product.price %}<span class="cat-prod__sale-badge">SALE</span>{% endif %}
                    </div>
                    <div class="cat-prod__title"><p>{{ product.title }}</p></div>
                    <div>
                      {% if product.compare_at_price > product.price %}<span class="cat-prod_cmp-price">{{ product.compare_at_price | money }}</span>{% endif %}
                      <span class="cat-prod_price">{{ product.price | money }}</span>
                    </div>
                  </a>
                {%- endfor -%}
              {%- else -%}
                <p>Select a collection in block settings.</p>
              {%- endif -%}
            </div>
          </div>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
  {%- endif -%}
</sticky-header>

<div id="mobile-menu-drawer" class="mm" aria-hidden="true">
  <div class="mm__scrim" onclick="closeMobileMenu()"></div>
  <div class="mm__panel">
    
    <header class="mm__top">
      <div class="mm__left">
        <button class="mm2__back" type="button" onclick="goBackMobile()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
        </button>
        <span class="mm__brand">
           {% if section.settings.logo_mobile != blank %}
             <img src="{{ section.settings.logo_mobile | image_url: width: 100 }}" style="height: 20px; width: auto;">
           {% else %}
             <strong>Categories</strong>
           {% endif %}
        </span>
        <span class="mm__crumb" style="display:none; font-weight:bold;"></span>
      </div>
      <button class="mm__close" type="button" onclick="closeMobileMenu()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    </header>

    <div class="mm__steps">
      <div class="mm__step mm__step--1">
        <div style="font-size: 11px; color: #999; margin-bottom: 10px; letter-spacing: 1px;">CATEGORIES</div>
        {%- for block in section.blocks -%}
          {%- if block.type == 'mega_menu' -%}
            <button class="mm-cat__btn" onclick="openCat('tab-{{ block.id }}', '{{ block.settings.tab_title }}')">
              <span class="mm-cat__icon">
                {% if block.settings.mobile_icon != blank %}
                  <img src="{{ block.settings.mobile_icon | image_url: width: 64 }}">
                {% else %}
                  <div style="width:50px; height:50px; background:#eee; border-radius:8px;"></div>
                {% endif %}
              </span>
              <span class="mm-cat__title">{{ block.settings.tab_title }}</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
            </button>
          {%- endif -%}
        {%- endfor -%}
        
        <div class="mm__footer">
           {%- for block in section.blocks -%}
             {%- if block.type == 'mobile_link' -%}
                <a href="{{ block.settings.url }}" class="mm__footer-link">{{ block.settings.title }}</a>
             {%- endif -%}
           {%- endfor -%}
        </div>
      </div>

      <div class="mm__step mm__step--2">
        {%- for block in section.blocks -%}
          {%- if block.type == 'mega_menu' -%}
            <div class="mm2__list hidden" id="mobile-products-tab-{{ block.id }}">
              {%- if block.settings.collection != blank -%}
                {%- for product in collections[block.settings.collection].products limit: 6 -%}
                  <a href="{{ product.url }}" class="mm2-item">
                    <div class="mm2-item__img">
                      <img src="{{ product.featured_image | image_url: width: 160 }}">
                    </div>
                    <div class="mm2-item__body">
                      <div class="mm2-item__title">{{ product.title }}</div>
                      <div class="mm2-item__sub">{{ product.price | money }}</div>
                    </div>
                  </a>
                {%- endfor -%}
              {%- endif -%}
              
              {% if block.settings.review_text != blank %}
                <div style="background:#f4f4f4; padding:15px; border-radius:8px; margin-top:20px; font-size:12px;">
                  <i>"{{ block.settings.review_text }}"</i>
                  <br><strong>- {{ block.settings.reviewer_name }}</strong>
                </div>
              {% endif %}
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>

  </div>
</div>

<script>
  // DESKTOP TABS LOGIC
  (function(){
    const root = document.getElementById('cat-portals-container');
    const tabs = document.querySelectorAll('.cat-strip__item');
    if(!root) return;

    function closeAll(){
      root.hidden = true;
      root.querySelectorAll('.cat-portal').forEach(el => el.setAttribute('aria-hidden', 'true'));
      tabs.forEach(t => t.classList.remove('is-active'));
    }

    tabs.forEach(btn => {
      btn.addEventListener('mouseenter', () => {
        const key = btn.dataset.key;
        closeAll();
        const portal = root.querySelector(`.cat-portal[data-key="${key}"]`);
        if(portal){
          root.hidden = false;
          portal.setAttribute('aria-hidden', 'false');
          btn.classList.add('is-active');
        }
      });
    });

    document.querySelector('.cat-strip-wrapper').addEventListener('mouseleave', closeAll);
  })();

  // MOBILE DRAWER LOGIC
  const drawer = document.getElementById('mobile-menu-drawer');
  const panel = drawer.querySelector('.mm__panel');
  const brand = drawer.querySelector('.mm__brand');
  const crumb = drawer.querySelector('.mm__crumb');
  
  function openMobileMenu() {
    drawer.classList.add('is-open');
    document.body.style.overflow = 'hidden';
  }

  function closeMobileMenu() {
    drawer.classList.remove('is-open');
    document.body.style.overflow = '';
    setTimeout(goBackMobile, 300); // Reset to step 1 after closing
  }

  function openCat(id, title) {
    // Show correct products
    document.querySelectorAll('.mm2__list').forEach(el => el.classList.add('hidden'));
    const target = document.getElementById('mobile-products-' + id);
    if(target) target.classList.remove('hidden');

    // Slide Animation
    panel.classList.add('mm-panel--step2');
    
    // Update Header
    brand.style.display = 'none';
    crumb.style.display = 'block';
    crumb.textContent = title;
  }

  function goBackMobile() {
    panel.classList.remove('mm-panel--step2');
    brand.style.display = 'block';
    crumb.style.display = 'none';
  }
</script>

{% schema %}
{
  "name": "Competitor Header (A-Z)",
  "class": "section-header",
  "settings": [
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Desktop Logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 250,
      "step": 5,
      "unit": "px",
      "label": "Logo Width",
      "default": 130
    },
    {
      "type": "image_picker",
      "id": "logo_mobile",
      "label": "Mobile Menu Logo",
      "info": "Shown at the top of the open drawer"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "logo_position",
      "options": [
        { "value": "middle-left", "label": "Middle Left" },
        { "value": "middle-center", "label": "Middle Center" }
      ],
      "default": "middle-left",
      "label": "Desktop Logo Position"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Padding Top",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 20
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Bottom Margin",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "mega_menu",
      "name": "Category Tab (Mega Menu)",
      "settings": [
        {
          "type": "text",
          "id": "tab_title",
          "label": "Tab/Category Title",
          "default": "Best Sellers"
        },
        {
          "type": "header",
          "content": "Desktop Mega Menu Content"
        },
        {
          "type": "url",
          "id": "link_url",
          "label": "Link URL"
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Link Text",
          "default": "Shop All"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Short Description",
          "default": "<p>High quality products.</p>"
        },
        {
          "type": "image_picker",
          "id": "reviewer_image",
          "label": "Reviewer Image"
        },
        {
          "type": "text",
          "id": "reviewer_name",
          "label": "Reviewer Name",
          "default": "John Doe"
        },
        {
          "type": "text",
          "id": "review_text",
          "label": "Review Text",
          "default": "Amazing product!"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Product Collection",
          "info": "Shows first 3 products on Desktop, 6 on Mobile."
        },
        {
          "type": "header",
          "content": "Mobile Settings"
        },
        {
          "type": "image_picker",
          "id": "mobile_icon",
          "label": "Mobile Menu Icon",
          "info": "Small icon shown next to category name in drawer"
        }
      ]
    },
    {
      "type": "mobile_link",
      "name": "Mobile Footer Link",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Link Label",
          "default": "Contact Us"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link URL"
        }
      ]
    }
  ]
}
{% endschema %}