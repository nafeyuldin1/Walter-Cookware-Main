{{ 'section-main-product.css' | asset_url | stylesheet_tag }}
{{ 'component-accordion.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}
{{ 'component-rating.css' | asset_url | stylesheet_tag }}
{{ 'component-deferred-media.css' | asset_url | stylesheet_tag }}
{{ 'component-loading-spinner.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Custom Section Styling */
  #MainProduct-{{ section.id }} {
    background: {{ section.settings.bg_gradient | default: section.settings.bg_color }};
    color: {{ section.settings.text_color }};
  }

  /* Typography Overrides */
  #MainProduct-{{ section.id }} h1, 
  #MainProduct-{{ section.id }} h2, 
  #MainProduct-{{ section.id }} h3, 
  #MainProduct-{{ section.id }} .h1, 
  #MainProduct-{{ section.id }} .h2 {
    color: {{ section.settings.title_color }};
    font-family: 'Neue Montreal', sans-serif, var(--font-heading-family);
  }

  /* Price Styling */
  .ctm-price__current { font-size: 32px; font-weight: 500; color: {{ section.settings.price_color }} !important; }
  .ctm-price__compare { font-size: 32px; text-decoration: line-through; color: {{ section.settings.compare_price_color }} !important; opacity: 0.7; }
  .ctm-price__save { 
    background: {{ section.settings.sale_badge_bg }}; 
    color: {{ section.settings.sale_badge_text }}; 
    padding: 4px 12px; 
    border-radius: 20px; 
    font-size: 14px; 
    font-weight: bold;
    vertical-align: middle;
    margin-left: 10px;
  }
  .ctm-price__row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;}

  /* Bundle Widget Styling */
  .pb-wrap { margin: 20px 0; border-radius: 12px; overflow: hidden; }
  .pb-sizes-head { display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: 500; }
  .pb-size-tabs { display: grid; grid-template-columns: repeat(4, 1fr); border: 1px solid {{ section.settings.bundle_border_color }}; border-radius: 8px; overflow: hidden; }
  .pb-size-tab { text-align: center; padding: 12px 5px; cursor: pointer; transition: 0.3s; background: transparent; color: {{ section.settings.text_color }}; border-right: 1px solid {{ section.settings.bundle_border_color }}; font-size: 13px; }
  .pb-size-tab:last-child { border-right: none; }
  .pb-size-tab.is-active { background: {{ section.settings.bundle_active_bg }}; color: #000; font-weight: bold; }
  
  .pb-atc-btn {
    width: 100%;
    padding: 16px;
    background: {{ section.settings.atc_bg }};
    color: {{ section.settings.atc_text }};
    border: none;
    border-radius: 8px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: opacity 0.2s;
    margin-top: 15px;
  }
  .pb-atc-btn:hover { opacity: 0.9; }

  /* Shipping Bar */
  .shipbar { display: flex; align-items: center; gap: 15px; padding: 12px; border-radius: 8px; margin: 15px 0; font-size: 13px; }
  .shipbar__label { font-weight: 700; white-space: nowrap; }
  .shipbar__list { display: flex; gap: 15px; flex-wrap: wrap; }
  .shipbar__item { display: flex; align-items: center; gap: 5px; }

  /* Accordion Custom */
  .pfaq-item { border-bottom: 1px solid rgba(255,255,255,0.15); }
  .pfaq-head { width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 15px 0; background: none; border: none; color: inherit; cursor: pointer; text-align: left; font-size: 16px; font-weight: 500; }
  .pfaq-body { padding-bottom: 15px; color: rgba(255,255,255,0.8); }

  /* Impact Note */
  .impact-note { display: flex; align-items: center; border-radius: 12px; overflow: hidden; margin: 20px 0; }
  .impact-note__icon { padding: 20px; background: rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; }
  .impact-note__text { padding: 20px; flex: 1; font-size: 14px; line-height: 1.5; }

  /* Size Guide Modal */
  .sg-modal {
    position: fixed; inset: 0; z-index: 99999;
    display: none; /* Hidden by default */
    align-items: center; justify-content: center;
    background: rgba(0,0,0,0.5);
  }
  .sg-modal.is-open {
    display: flex; /* Flex when open */
  }

  /* --- Advanced Tabs (.pit) --- */
  .pit { color: {{ section.settings.text_color }}; margin: 30px 0; }
  .pit-tabs { display: grid; grid-template-columns: repeat(3, 1fr); border-bottom: 1px solid rgba(255,255,255,0.2); margin-bottom: 20px; }
  .pit-tab { 
    background: transparent; border: none; padding: 15px 5px; cursor: pointer; 
    color: {{ section.settings.text_color }}; opacity: 0.6; font-size: 14px; font-weight: 500; 
    display: flex;align-items: center; gap: 5px; position: relative;
  }
  .pit-tab.is-active { opacity: 1; }
  .pit-underline { height: 2px; width: 100%; background: #fff; position: absolute; bottom: 0; opacity: 0; transition: 0.3s; }
  .pit-tab.is-active .pit-underline { opacity: 1; }
  .pit-panel { display: none; animation: fadeIn 0.5s; }
  .pit-panel.is-active { display: block; }
  .pit-copy p { margin: 0 0 15px; font-size: 15px; line-height: 1.5; color: {{ section.settings.text_color }}; opacity: 0.8; }
  .pit-copy strong { color: #fff; opacity: 1; }
  .pit-images { display: flex; gap: 10px; }
  .pit-images img { width: 100%; border-radius: 8px; }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

  /* --- Health Benefits List (.hb-c-list) --- */
  .hb-c-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 15px; }
  .hbci { display: flex; gap: 10px; align-items: flex-start; }
  .hbci-ic { width: 20px; flex-shrink: 0; color: #fff; margin-top: 3px; }
  .hbci-title { display: block; font-weight: 600; color: #fff; font-size: 15px; }
  .hbci-desc { display: block; font-size: 14px; color: {{ section.settings.text_color }}; opacity: 0.8; line-height: 1.4; }

  /* --- Upsells --- */
  .upsell-two { margin-top: 40px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 25px; }
  .upsell-two__title { font-size: 20px; margin-bottom: 20px; color: #fff; }
  .upsell-card { display: flex; background: #fff; border-radius: 10px; padding: 10px; gap: 15px; align-items: center; color: #121212; margin-bottom: 10px; }
  .upsell-card__media { width: 80px; height: 80px; flex-shrink: 0; }
  .upsell-card__media img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }
  .upsell-card__main { flex: 1; }
  .upsell-card__name { font-size: 14px; font-weight: 600; margin: 0 0 5px; color: #000; }
  .upsell-price-with-button { display: flex; justify-content: space-between; align-items: center; }
  .upsell-card__price { font-size: 16px; font-weight: 600; color: #000; }
  .upsell-card__compare { font-size: 12px; text-decoration: line-through; color: #888; margin-right: 5px; }
  .upsell-card__atc { background: #A3835F; color: #fff; border: none; padding: 6px 14px; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px; }


{%- endstyle -%}

<script src="{{ 'product-info.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>

<section id="MainProduct-{{ section.id }}" class="section-{{ section.id }}-padding" data-section="{{ section.id }}">
  <div class="page-width">
    <div class="product product--{{ section.settings.media_size }} product--{{ section.settings.media_position }} product--{{ section.settings.gallery_layout }} grid grid--1-col {% if product.media.size > 0 %}grid--2-col-tablet{% else %}product--no-media{% endif %}">
      
      <div class="grid__item product__media-wrapper">
        {% assign variant_images = product.images | where: 'attached_to_variant?', true | map: 'src' %}
        {% render 'product-media-gallery', variant_images: variant_images %}
      </div>

      <div class="product__info-wrapper grid__item">
        <product-info id="ProductInfo-{{ section.id }}" class="product__info-container{% if section.settings.enable_sticky_info %} product__column-sticky{% endif %}">
          
          {%- for block in section.blocks -%}
            {%- case block.type -%}
              
              {%- when '@app' -%}
                {% render block %}

              {%- when 'text' -%}
                <p class="product__text inline-richtext" style="color: {{ block.settings.color }}; margin-bottom: {{ block.settings.margin_bottom }}px; letter-spacing: 0.5px; text-transform: {{ block.settings.text_style }};" {{ block.shopify_attributes }}>
                  {{ block.settings.text }}
                </p>

              {%- when 'title' -%}
                <h1 class="product__title" {{ block.shopify_attributes }} style="margin-bottom: 10px;">
                  {{ product.title | escape }}
                </h1>

              {%- when 'price' -%}
                <div class="no-js-hidden" id="price-{{ section.id }}" role="status" {{ block.shopify_attributes }}>
                  {%- if block.settings.show_description -%}
                    <div class="description_ctm" style="margin-bottom: 15px; opacity: 0.8;">{{ product.description | strip_html | truncatewords: 25 }}</div>
                  {%- endif -%}
                  
                  <div class="price-wrapper">
                    <div class="ctm-price__row">
                      {%- if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price -%}
                        <s class="ctm-price__compare">{{ product.selected_or_first_available_variant.compare_at_price | money }}</s>
                      {%- endif -%}
                      <span class="ctm-price__current">{{ product.selected_or_first_available_variant.price | money }}</span>
                      {%- if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price -%}
                        <span class="ctm-price__save">{{ block.settings.sale_badge_text }}</span>
                      {%- endif -%}
                    </div>
                  </div>
                  
                  {%- if product.quantity_price_breaks_configured? -%}
                    <div class="volume-pricing-note">
                      <span>{{ 'products.product.volume_pricing.note' | t }}</span>
                    </div>
                  {%- endif -%}
                </div>

              {%- when 'benefits_grid' -%}
                <div class="benefits-grid" id="benefits-{{ block.id }}" {{ block.shopify_attributes }}>
                  <style>
                    #benefits-{{ block.id }} { margin: 24px 0; color: {{ block.settings.text_color }}; }
                    #benefits-{{ block.id }} .benefits-grid__list { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
                    #benefits-{{ block.id }} .benefits-grid__item { display: flex; align-items: center; gap: 10px; }
                    #benefits-{{ block.id }} img, #benefits-{{ block.id }} svg { width: 24px; height: 24px; }
                    #benefits-{{ block.id }} p { margin: 0; font-size: 13px; line-height: 1.3; }
                    #benefits-{{ block.id }} strong { color: #fff; }
                  </style>
                  <div class="benefits-grid__list">
                    {% for i in (1..4) %}
                      {% capture icon_key %}icon_{{ i }}{% endcapture %}
                      {% capture text_key %}text_{{ i }}{% endcapture %}
                      {% if block.settings[text_key] != blank %}
                      <div class="benefits-grid__item">
                        <div class="benefits-grid__icon">
                          {% if block.settings[icon_key] != blank %}
                            <img src="{{ block.settings[icon_key] | image_url: width: 48 }}" width="24" height="24" loading="lazy">
                          {% else %}
                             <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/><path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                          {% endif %}
                        </div>
                        <div class="benefits-grid__text">{{ block.settings[text_key] }}</div>
                      </div>
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>

              {%- when 'scrolling_icons' -%}
                <div id="pf-icons-{{ block.id }}" class="pf-wrap" style="margin: 20px 0;" {{ block.shopify_attributes }}>
                  <style>
                    #pf-icons-{{ block.id }} .pf-track { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
                    #pf-icons-{{ block.id }} .pf-track::-webkit-scrollbar { display: none; }
                    #pf-icons-{{ block.id }} .pf-item { min-width: 80px; text-align: center; flex: 0 0 auto; }
                    #pf-icons-{{ block.id }} .pf-icon img { margin: 0 auto; display: block; width: 40px; height: 40px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); padding: 8px; object-fit: contain;}
                    #pf-icons-{{ block.id }} .pf-text { font-size: 11px; margin-top: 8px; color: {{ block.settings.text_color }}; line-height: 1.2; }
                  </style>
                  <div class="pf-track">
                    {% for i in (1..8) %}
                      {% capture icon_key %}icon_{{ i }}{% endcapture %}
                      {% capture label_key %}label_{{ i }}{% endcapture %}
                      {% if block.settings[label_key] != blank %}
                        <div class="pf-item">
                          <div class="pf-icon">
                            {% if block.settings[icon_key] != blank %}
                              <img src="{{ block.settings[icon_key] | image_url: width: 80 }}" width="40" height="40" loading="lazy">
                            {% else %}
                              <img src="https://cdn.shopify.com/s/files/1/0628/3503/files/check-mark.svg?v=1666191763" width="40" height="40">
                            {% endif %}
                          </div>
                          <div class="pf-text">{{ block.settings[label_key] }}</div>
                        </div>
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>

              {%- when 'bundle_widget' -%}
                <div id="pb-bundles-{{ section.id }}" class="pb-wrap" {{ block.shopify_attributes }}>
                  <div class="pb-sizes">
                    <div class="pb-sizes-head">
                      <label class="pb-label">{{ block.settings.size_label }}</label>
                      <button type="button" class="sbp-size-guide" onclick="toggleSizeGuide(true)" style="background:none; border:none; color: inherit; text-decoration: underline; cursor: pointer; padding: 0;">{{ block.settings.size_guide_text }}</button>
                    </div>
                    <div class="pb-size-tabs">
                      {% for variant in product.variants %}
                        <div class="pb-size-tab {% if product.selected_or_first_available_variant.id == variant.id %}is-active{% endif %}" 
                             data-variant-id="{{ variant.id }}"
                             data-price="{{ variant.price | money }}"
                             onclick="updateBundleVariant(this)">
                          {{ variant.option1 }}
                        </div>
                      {% endfor %}
                      {% comment %} Fallback tabs if no variants or to show style {% endcomment %}
                      {% if product.variants.size < 2 %}
                         {% for i in (1..4) %}
                            {% capture tab_label %}tab_{{ i }}_label{% endcapture %}
                            {% if block.settings[tab_label] != blank %}
                               <div class="pb-size-tab {% if forloop.first %}is-active{% endif %}">{{ block.settings[tab_label] }}</div>
                            {% endif %}
                         {% endfor %}
                      {% endif %}
                    </div>
                  </div>
                  
                  <div class="pb-atc-wrap">
                    <form method="post" action="/cart/add" class="product-form" id="product-form-{{ section.id }}">
                      <input type="hidden" name="id" id="bundle-variant-input" value="{{ product.selected_or_first_available_variant.id }}">
                      <button type="submit" class="pb-atc-btn" id="bundle-atc-btn">
                        {{ 'products.product.add_to_cart' | t }} - <span id="bundle-price-display">{{ product.selected_or_first_available_variant.price | money }}</span>
                      </button>
                    </form>
                  </div>
                  
                  <div class="secure-checkout" style="margin-top:15px; text-align:center;">
                    <div class="secure-note" style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">
                      <span style="margin-right:5px">üîí</span> <span class="guarantee-text">{{ block.settings.guarantee_text }}</span>
                    </div>
                    <div class="pay-badges" style="display: flex; justify-content: center; gap: 5px;">
                      {% for type in shop.enabled_payment_types %}
                        {{ type | payment_type_svg_tag: class: 'icon icon--full-color', style: 'width: 38px;' }}
                      {% endfor %}
                    </div>
                  </div>
                </div>
                
                <script>
                  function updateBundleVariant(element) {
                    // Visual update
                    document.querySelectorAll('.pb-size-tab').forEach(el => el.classList.remove('is-active'));
                    element.classList.add('is-active');
                    // Data update
                    const id = element.dataset.variantId;
                    const price = element.dataset.price;
                    document.getElementById('bundle-variant-input').value = id;
                    document.getElementById('bundle-price-display').innerText = price;
                  }
                </script>

              {%- when 'shipping_bar' -%}
                <div class="shipbar" style="background: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }};" {{ block.shopify_attributes }}>
                  <div class="shipbar__label" style="font-size: 16px;">{{ block.settings.alert_text }}</div>
                  <div class="shipbar__list">
                    {% if block.settings.text_1 != blank %}
                    <div class="shipbar__item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                      <span>{{ block.settings.text_1 }}</span>
                    </div>
                    {% endif %}
                    {% if block.settings.text_2 != blank %}
                    <div class="shipbar__item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                      <span>{{ block.settings.text_2 }}</span>
                    </div>
                    {% endif %}
                  </div>
                </div>

              {%- when 'info_tabs' -%}
                <div class="pit" {{ block.shopify_attributes }}>
                  <div class="pit-tabs">
                    <button class="pit-tab" onclick="openPitTab(event, 'tab-2')">
                       <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L3 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-9-5z"/></svg>
                       {{ block.settings.tab_1_label }}
                      <span class="pit-underline"></span>
                    </button>
                    <button class="pit-tab" onclick="openPitTab(event, 'tab-3')">
                       {{ block.settings.tab_2_label }}
                      <span class="pit-underline"></span>
                    </button>
                    <button class="pit-tab is-active" onclick="openPitTab(event, 'tab-1')">
                      {{ block.settings.tab_3_label }}
                      <span class="pit-underline"></span>
                    </button>
                  </div>

                  <div id="tab-1" class="pit-panel is-active">
                     <h3 class="hb-title" style="margin-bottom: 20px;">{{ block.settings.tab_3_heading }}</h3>
                     <div class="hb-compact">
                       <ul class="hb-c-list">
                         {% assign content_parts = block.settings.tab_3_content | split: '<strong>' %}
                         {% for part in content_parts offset:1 %}
                           {% assign title = part | split: '</strong>' | first %}
                           {% assign desc = part | split: '</strong>' | last | remove: '<p>' | remove: '</p>' %}
                           <li class="hbci">
                             <span class="hbci-ic"><svg width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor"><circle cx="10" cy="10" r="8.25" stroke-width="1.5"/><path d="M6.5 10.2l2.2 2.1L13.8 7.6" stroke-width="1.5"/></svg></span>
                             <div class="hbci-text">
                               <span class="hbci-title">{{ title }}</span>
                               <span class="hbci-desc">{{ desc }}</span>
                             </div>
                           </li>
                         {% endfor %}
                       </ul>
                     </div>
                  </div>

                  <div id="tab-2" class="pit-panel">
                    <div class="pit-copy">{{ block.settings.tab_1_content }}</div>
                    {% if block.settings.tab_1_image != blank %}
                      <div class="pit-images" style="margin-top: 20px;">
                        <img src="{{ block.settings.tab_1_image | image_url: width: 600 }}" width="100%" height="auto">
                      </div>
                    {% endif %}
                  </div>

                  <div id="tab-3" class="pit-panel">
                     {% if block.settings.tab_2_image != blank %}
                        <img src="{{ block.settings.tab_2_image | image_url: width: 800 }}" width="100%" height="auto">
                     {% else %}
                        <p>No image selected for comparison.</p>
                     {% endif %}
                  </div>
                </div>

                <script>
                  function openPitTab(evt, tabName) {
                    var i, tabcontent, tablinks;
                    tabcontent = document.getElementsByClassName("pit-panel");
                    for (i = 0; i < tabcontent.length; i++) {
                      tabcontent[i].style.display = "none";
                    }
                    tablinks = document.getElementsByClassName("pit-tab");
                    for (i = 0; i < tablinks.length; i++) {
                      tablinks[i].className = tablinks[i].className.replace(" is-active", "");
                    }
                    document.getElementById(tabName).style.display = "block";
                    evt.currentTarget.className += " is-active";
                  }
                </script>

              {%- when 'accordion' -%}
                <div class="pfaq-item" {{ block.shopify_attributes }}>
                  <details>
                    <summary class="pfaq-head">
                      <span class="pfaq-left" style="display: flex; gap: 12px; align-items: center;">
                        {% if block.settings.icon != blank %}<img src="{{ block.settings.icon | image_url: width: 24 }}" width="24" height="24">{% endif %}
                        <span class="pfaq-title">{{ block.settings.heading }}</span>
                      </span>
                      <span class="pfaq-plus">+</span>
                    </summary>
                    <div class="pfaq-body rte">
                      {{ block.settings.content }}
                    </div>
                  </details>
                </div>

              {%- when 'impact_note' -%}
                <div class="impact-note" style="background: {{ block.settings.bg_color }};" {{ block.shopify_attributes }}>
                  <div class="impact-note__icon-wrap">
                    {% if block.settings.icon != blank %}
                      <img src="{{ block.settings.icon | image_url: width: 64 }}" width="40" height="40" style="display:block;">
                    {% endif %}
                  </div>
                  <p class="impact-note__text" style="color: {{ block.settings.text_color }};">
                    {{ block.settings.text }}
                  </p>
                </div>

              {%- when 'upsells' -%}
                <div class="upsell-two" {{ block.shopify_attributes }}>
                  <h3 class="upsell-two__title">{{ block.settings.title }}</h3>
                  {% for i in (1..2) %}
                    {% capture prod_key %}product_{{ i }}{% endcapture %}
                    {% assign up_prod = all_products[block.settings[prod_key]] %}
                    {% if up_prod != empty %}
                    <div class="upsell-card">
                      <div class="upsell-card__media">
                        <img src="{{ up_prod.featured_image | image_url: width: 200 }}" loading="lazy">
                      </div>
                      <div class="upsell-card__main">
                        <h4 class="upsell-card__name">{{ up_prod.title }}</h4>
                        <div class="upsell-price-with-button">
                          <div class="upsell-card__price">
                            {% if up_prod.compare_at_price > up_prod.price %}
                              <s class="upsell-card__compare">{{ up_prod.compare_at_price | money }}</s>
                            {% endif %}
                            <span class="upsell-card__sale">{{ up_prod.price | money }}</span>
                          </div>
                          <form method="post" action="/cart/add">
                            <input type="hidden" name="id" value="{{ up_prod.selected_or_first_available_variant.id }}">
                            <button type="submit" class="upsell-card__atc">Add To Cart</button>
                          </form>
                        </div>
                      </div>
                    </div>
                    {% endif %}
                  {% endfor %}
                </div>

            {%- endcase -%}
          {%- endfor -%}

        </product-info>
      </div>
    </div>
  </div>

  {% for block in section.blocks %}
    {% if block.type == 'sticky_atc' %}
      <div id="sticky-cta-{{ section.id }}" class="sticky-cta is-on" style="position: fixed; bottom: 20px; right: 20px; background: #121212; color: #fff; padding: 15px; border-radius: 12px; z-index: 999; display: flex; gap: 15px; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform: translateY(150%); transition: transform 0.3s ease;">
        <img src="{{ product.featured_image | image_url: width: 60 }}" width="60" height="60" style="border-radius: 8px;">
        <div class="small-hide">
          <div style="font-weight: bold; font-size: 14px;">{{ product.title | truncate: 30 }}</div>
          <div style="color: #e23223; font-size: 12px; font-weight: bold; text-transform: uppercase;">{{ block.settings.alert_text }}</div>
        </div>
        <button onclick="document.querySelector('.product-form').scrollIntoView({behavior: 'smooth'})" style="background: #fff; color: #000; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer;">
          {{ block.settings.btn_text }}
        </button>
      </div>
      <script>
        window.addEventListener('scroll', function() {
          const sticky = document.getElementById('sticky-cta-{{ section.id }}');
          if(window.scrollY > 400) {
            sticky.style.transform = 'translateY(0)';
          } else {
            sticky.style.transform = 'translateY(150%)';
          }
        });
      </script>
    {% endif %}
  {% endfor %}

  <div id="sg-modal" class="sg-modal">
    <div style="background: #fff; padding: 30px; border-radius: 12px; position: relative; max-width: 600px; width: 90%; color: #000;">
       <button type="button" onclick="toggleSizeGuide(false)" style="position: absolute; right: 15px; top: 15px; background: none; border: none; font-size: 20px; cursor: pointer; color: #000;">‚úï</button>
       <h2 style="margin-top:0; color:#000;">Size Guide</h2>
       <img src="https://cdn.shopify.com/s/files/1/0742/4635/7257/files/Frame_1171274894.png?v=1756269962" style="width:100%; height:auto; margin-bottom:15px; border-radius: 8px;">
       <table style="width:100%; border-collapse: collapse; font-size: 14px;">
         <tr style="background:#f4f4f4;"><th style="padding:10px; border:1px solid #eee;">Size</th><th style="padding:10px; border:1px solid #eee;">Diameter</th><th style="padding:10px; border:1px solid #eee;">Length</th></tr>
         <tr><td style="padding:10px; border:1px solid #eee; text-align:center;">Mini</td><td style="padding:10px; border:1px solid #eee; text-align:center;">9.5"</td><td style="padding:10px; border:1px solid #eee; text-align:center;">18.5"</td></tr>
         <tr><td style="padding:10px; border:1px solid #eee; text-align:center;">Standard</td><td style="padding:10px; border:1px solid #eee; text-align:center;">10.2"</td><td style="padding:10px; border:1px solid #eee; text-align:center;">18.9"</td></tr>
         <tr><td style="padding:10px; border:1px solid #eee; text-align:center;">Large</td><td style="padding:10px; border:1px solid #eee; text-align:center;">11.8"</td><td style="padding:10px; border:1px solid #eee; text-align:center;">21"</td></tr>
       </table>
    </div>
  </div>

  <script>
    function toggleSizeGuide(show) {
      const modal = document.getElementById('sg-modal');
      if (modal) {
        if (show) {
          modal.classList.add('is-open');
          modal.style.display = 'flex';
        } else {
          modal.classList.remove('is-open');
          modal.style.display = 'none';
        }
      }
    }
    
    // Close modal when clicking outside content
    document.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('sg-modal');
      if(modal) {
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            toggleSizeGuide(false);
          }
        });
      }
    });
  </script>

</section>

{% schema %}
{
  "name": "Main Product Dynamic",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#121212"
    },
    {
      "type": "color_background",
      "id": "bg_gradient",
      "label": "Background Gradient",
      "default": "linear-gradient(90deg, #3b3e41 0%, #181a1b 100%)"
    },
    {
      "type": "color",
      "id": "bg_color_secondary",
      "label": "Secondary Background (Bars/Notes)",
      "default": "#03231A"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Typography Colors"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price Color",
      "default": "#E9E2D8"
    },
    {
      "type": "color",
      "id": "compare_price_color",
      "label": "Compare Price Color",
      "default": "#888888"
    },
    {
      "type": "color",
      "id": "sale_badge_bg",
      "label": "Sale Badge Background",
      "default": "#097350"
    },
    {
      "type": "color",
      "id": "sale_badge_text",
      "label": "Sale Badge Text",
      "default": "#E9E2D8"
    },
    {
      "type": "header",
      "content": "Bundle Widget Colors"
    },
    {
      "type": "color",
      "id": "bundle_active_bg",
      "label": "Active Tab BG",
      "default": "#F6F4F0"
    },
    {
      "type": "color",
      "id": "bundle_border_color",
      "label": "Tab Border Color",
      "default": "#454545"
    },
    {
      "type": "color",
      "id": "atc_bg",
      "label": "ATC Button Background",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "atc_text",
      "label": "ATC Button Text",
      "default": "#121212"
    },
    {
      "type": "header",
      "content": "Media Settings"
    },
    {
      "type": "select",
      "id": "media_size",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ],
      "default": "large",
      "label": "Media Size"
    },
    {
      "type": "select",
      "id": "media_position",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left",
      "label": "Media Position"
    },
    {
      "type": "select",
      "id": "gallery_layout",
      "options": [
        { "value": "stacked", "label": "Stacked" },
        { "value": "columns", "label": "Columns" },
        { "value": "thumbnail", "label": "Thumbnails" },
        { "value": "thumbnail_slider", "label": "Thumbnail Slider" }
      ],
      "default": "thumbnail_slider",
      "label": "Gallery Layout"
    },
    {
      "type": "select",
      "id": "mobile_thumbnails",
      "options": [
        { "value": "columns", "label": "Columns" },
        { "value": "show", "label": "Show" },
        { "value": "hide", "label": "Hide" }
      ],
      "default": "hide",
      "label": "Mobile Thumbnails"
    },
    {
      "type": "checkbox",
      "id": "hide_variants",
      "default": false,
      "label": "Hide Variant Media"
    },
    {
      "type": "checkbox",
      "id": "enable_video_looping",
      "default": false,
      "label": "Enable Video Looping"
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 36
    }
  ],
  "blocks": [
    { "type": "@app" },
    {
      "type": "text",
      "name": "Text",
      "settings": [
        { "type": "text", "id": "text", "default": "Immaculate Performance", "label": "Text" },
        { "type": "color", "id": "color", "label": "Color", "default": "#B0B0B0" },
        { "type": "select", "id": "text_style", "options": [{ "value": "body", "label": "Body" }, { "value": "subtitle", "label": "Subtitle" }, { "value": "uppercase", "label": "Uppercase" }], "default": "body", "label": "Text Style" },
        { "type": "range", "id": "margin_bottom", "min": 0, "max": 50, "step": 2, "unit": "px", "label": "Margin Bottom", "default": 12 }
      ]
    },
    { "type": "title", "name": "Title", "limit": 1 },
    {
      "type": "price",
      "name": "Price",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "sale_badge_text", "label": "Sale Badge Text", "default": "SALE ENDS SOON!" },
        { "type": "checkbox", "id": "show_description", "label": "Show Short Description", "default": true }
      ]
    },
    {
      "type": "benefits_grid",
      "name": "Benefits Grid (4 Icons)",
      "limit": 1,
      "settings": [
        { "type": "color", "id": "text_color", "label": "Text Color", "default": "#B0B0B0" },
        { "type": "image_picker", "id": "icon_1", "label": "Icon 1" }, { "type": "inline_richtext", "id": "text_1", "label": "Text 1", "default": "No PFAS, PTFE & PFOA." },
        { "type": "image_picker", "id": "icon_2", "label": "Icon 2" }, { "type": "inline_richtext", "id": "text_2", "label": "Text 2", "default": "Extreme Heat Resistant" },
        { "type": "image_picker", "id": "icon_3", "label": "Icon 3" }, { "type": "inline_richtext", "id": "text_3", "label": "Text 3", "default": "Non-Stick Surface" },
        { "type": "image_picker", "id": "icon_4", "label": "Icon 4" }, { "type": "inline_richtext", "id": "text_4", "label": "Text 4", "default": "Compatible With All Cooktops" }
      ]
    },
    {
      "type": "scrolling_icons",
      "name": "Scrolling Icons Bar",
      "settings": [
        { "type": "color", "id": "text_color", "label": "Text Color", "default": "#D4C7B4" },
        { "type": "image_picker", "id": "icon_1", "label": "Icon 1" }, { "type": "text", "id": "label_1", "label": "Label 1" },
        { "type": "image_picker", "id": "icon_2", "label": "Icon 2" }, { "type": "text", "id": "label_2", "label": "Label 2" },
        { "type": "image_picker", "id": "icon_3", "label": "Icon 3" }, { "type": "text", "id": "label_3", "label": "Label 3" },
        { "type": "image_picker", "id": "icon_4", "label": "Icon 4" }, { "type": "text", "id": "label_4", "label": "Label 4" },
        { "type": "image_picker", "id": "icon_5", "label": "Icon 5" }, { "type": "text", "id": "label_5", "label": "Label 5" },
        { "type": "image_picker", "id": "icon_6", "label": "Icon 6" }, { "type": "text", "id": "label_6", "label": "Label 6" },
        { "type": "image_picker", "id": "icon_7", "label": "Icon 7" }, { "type": "text", "id": "label_7", "label": "Label 7" },
        { "type": "image_picker", "id": "icon_8", "label": "Icon 8" }, { "type": "text", "id": "label_8", "label": "Label 8" }
      ]
    },
    {
      "type": "bundle_widget",
      "name": "Bundle / Variants",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "size_label", "label": "Label", "default": "Size:" },
        { "type": "text", "id": "size_guide_text", "label": "Guide Link Text", "default": "Size Guide" },
        { "type": "text", "id": "tab_1_label", "label": "Tab 1 Name", "default": "Mini" },
        { "type": "text", "id": "tab_2_label", "label": "Tab 2 Name", "default": "Standard" },
        { "type": "text", "id": "tab_3_label", "label": "Tab 3 Name", "default": "Versatile" },
        { "type": "text", "id": "tab_4_label", "label": "Tab 4 Name", "default": "Large" },
        { "type": "text", "id": "guarantee_text", "label": "Guarantee Text", "default": "Guaranteed Safe & Secure Checkout" }
      ]
    },
    {
      "type": "shipping_bar",
      "name": "Shipping Bar",
      "settings": [
        { "type": "color", "id": "bg_color", "label": "Background Color", "default": "#03231A" },
        { "type": "color", "id": "text_color", "label": "Text Color", "default": "#D4C7B4" },
        { "type": "text", "id": "alert_text", "label": "Left Label", "default": "‚ö†Ô∏è Might Not Arrive Before Christmas" },
        { "type": "text", "id": "text_1", "label": "Text 1", "default": "FREE Shipping & Easy Returns" },
        { "type": "text", "id": "text_2", "label": "Text 2", "default": "Lifetime Warranty" },
        { "type": "text", "id": "text_3", "label": "Text 3", "default": "100% Toxin-Free Guarantee" }
      ]
    },
    {
      "type": "info_tabs",
      "name": "Advanced Tabs (PIT)",
      "limit": 1,
      "settings": [
        { "type": "header", "content": "Tab 1 (Purity)" },
        { "type": "text", "id": "tab_1_label", "label": "Label", "default": "Purity Certification" },
        { "type": "richtext", "id": "tab_1_content", "label": "Description" },
        { "type": "image_picker", "id": "tab_1_image", "label": "Sticker Image" },

        { "type": "header", "content": "Tab 2 (Comparison)" },
        { "type": "text", "id": "tab_2_label", "label": "Label", "default": "Titanium Vs The Rest" },
        { "type": "image_picker", "id": "tab_2_image", "label": "Comparison Image" },

        { "type": "header", "content": "Tab 3 (Benefits)" },
        { "type": "text", "id": "tab_3_label", "label": "Label", "default": "Health Benefits" },
        { "type": "text", "id": "tab_3_heading", "label": "Heading", "default": "A New Standard in Safety." },
        { "type": "richtext", "id": "tab_3_content", "label": "List Items", "info": "Use Bold for titles. Example: <strong>Title</strong> Description" }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion Item",
      "settings": [
        { "type": "text", "id": "heading", "label": "Heading", "default": "Details, Care & Use" },
        { "type": "image_picker", "id": "icon", "label": "Icon" },
        { "type": "richtext", "id": "content", "label": "Content" }
      ]
    },
    {
      "type": "impact_note",
      "name": "Impact Note",
      "settings": [
        { "type": "color", "id": "bg_color", "label": "Background", "default": "#03231A" },
        { "type": "color", "id": "text_color", "label": "Text Color", "default": "#D4C7B4" },
        { "type": "image_picker", "id": "icon", "label": "Icon" },
        { "type": "textarea", "id": "text", "label": "Text", "default": "Part of your order helps create the future of toxin-free living." }
      ]
    },
    {
      "type": "upsells",
      "name": "Upsell Products",
      "settings": [
        { "type": "text", "id": "title", "label": "Heading", "default": "Complete Your Toxin-Free Kitchen" },
        { "type": "product", "id": "product_1", "label": "Product 1" },
        { "type": "product", "id": "product_2", "label": "Product 2" }
      ]
    },
    {
      "type": "sticky_atc",
      "name": "Sticky ATC",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "alert_text", "label": "Alert Text", "default": "ALMOST SOLD OUT" },
        { "type": "text", "id": "btn_text", "label": "Button Text", "default": "ADD TO CART" }
      ]
    },
    {
      "type": "variant_picker",
      "name": "Variant Picker",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "picker_type",
          "options": [
            { "value": "dropdown", "label": "Dropdown" },
            { "value": "button", "label": "Pills" }
          ],
          "default": "button",
          "label": "Type"
        }
      ]
    },
    {
      "type": "quantity_selector",
      "name": "Quantity Selector",
      "limit": 1
    },
    {
      "type": "buy_buttons",
      "name": "Buy Buttons",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "default": true,
          "label": "Show Dynamic Checkout Buttons"
        },
        {
          "type": "checkbox",
          "id": "show_gift_card_recipient",
          "default": true,
          "label": "Show Gift Card Recipient Form"
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1
    },
    {
      "type": "share",
      "name": "Share",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "share_label",
          "label": "Link label",
          "default": "Share"
        }
      ]
    },
    {
      "type": "rating",
      "name": "Rating",
      "limit": 1
    }
  ],
  "presets": [
    {
      "name": "Main Product Dynamic",
      "blocks": [
        { "type": "title" },
        { "type": "price" },
        { "type": "benefits_grid" },
        { "type": "scrolling_icons" },
        { "type": "bundle_widget" },
        { "type": "shipping_bar" },
        { "type": "info_tabs" },
        { "type": "accordion" },
        { "type": "impact_note" },
        { "type": "upsells" }
      ]
    }
  ]
}
{% endschema %}