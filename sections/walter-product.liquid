{{ 'section-main-product.css' | asset_url | stylesheet_tag }}
{{ 'component-accordion.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}
{{ 'component-rating.css' | asset_url | stylesheet_tag }}
{{ 'component-deferred-media.css' | asset_url | stylesheet_tag }}
{{ 'component-loading-spinner.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* --- Global Section Styling --- */
  #MainProduct-{{ section.id }} {
    background: {{ section.settings.bg_gradient | default: section.settings.bg_color }};
    color: {{ section.settings.text_color }};
  }

  #MainProduct-{{ section.id }} h1, #MainProduct-{{ section.id }} h2, #MainProduct-{{ section.id }} h3, 
  #MainProduct-{{ section.id }} .h1, #MainProduct-{{ section.id }} .h2 {
    color: {{ section.settings.title_color }};
    font-family: 'Neue Montreal', sans-serif, var(--font-heading-family);
  }

  /* --- COMPETITOR LAYOUT FIX (Thumbnails Left, Image Right) --- */
  @media screen and (min-width: 990px) {
    .product__media-wrapper media-gallery {
      display: flex !important;
      flex-direction: row-reverse !important; /* Slider Right, Thumbs Left */
      align-items: flex-start;
      gap: 20px;
    }
    
    /* Main Slider */
    #GalleryViewer-{{ section.id }} {
      flex: 1;
      width: calc(100% - 100px);
    }

    /* Thumbnails Strip */
    #GalleryThumbnails-{{ section.id }} {
      width: 90px !important;
      display: block !important;
    }

    /* Vertical List */
    #GalleryThumbnails-{{ section.id }} .thumbnail-list {
      display: flex !important;
      flex-direction: column !important;
      gap: 10px;
    }
    
    /* Hide slider arrows on desktop vertical strip */
    #GalleryThumbnails-{{ section.id }} .slider-button {
      display: none !important;
    }
  }

  /* --- Price --- */
  .ctm-price__current { font-size: 32px; font-weight: 500; color: {{ section.settings.price_color }} !important; display: block; }
  .ctm-price__compare { font-size: 32px; text-decoration: line-through; color: {{ section.settings.compare_price_color }} !important; opacity: 0.7; display: block; }
  .ctm-price__save { 
    background: {{ section.settings.sale_badge_bg }}; 
    color: {{ section.settings.sale_badge_text }}; 
    padding: 4px 12px; border-radius: 20px; font-size: 14px; font-weight: bold; vertical-align: middle; margin-left: 10px;
  }
  .ctm-price__row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;}

  /* --- Review Highlights --- */
  .rh-wrap { margin: 15px 0; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
  .rh-head { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
  .rh-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; background: #333; }
  .rh-name { font-weight: bold; font-size: 14px; color: #fff; }
  .rh-role { font-size: 12px; color: #ccc; }
  .rh-text { font-size: 13px; color: #bbb; font-style: italic; margin: 0; }
  .rh-stars svg { width: 14px; height: 14px; color: #B57C46; }

  /* --- Bundle Widget --- */
  .pb-wrap { margin: 24px 0; border-radius: 12px; overflow: hidden; }
  .pb-sizes-head { display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: 500; }
  .pb-size-tabs { display: grid; grid-template-columns: repeat(4, 1fr); border: 1px solid {{ section.settings.bundle_border_color }}; border-radius: 8px; overflow: hidden; }
  .pb-size-tab { 
    text-align: center; padding: 12px 5px; cursor: pointer; transition: 0.3s; 
    background: transparent; color: {{ section.settings.text_color }}; 
    border-right: 1px solid {{ section.settings.bundle_border_color }}; font-size: 13px; position: relative;
  }
  .pb-size-tab:last-child { border-right: none; }
  .pb-size-tab.is-active { background: {{ section.settings.bundle_active_bg }}; color: #000; font-weight: bold; }
  
  .pb-card { 
    background: #F6F4F0; border-radius: 12px; padding: 15px; margin-top: 15px; cursor: pointer; border: 2px solid transparent; transition: 0.3s; color: #000; position: relative;
  }
  .pb-card.active { border-color: {{ section.settings.sale_badge_bg }}; background: #fff; }
  .pb-card__badge { position: absolute; top: 0; right: 0; background: #e7d9bf; color: #000; font-size: 10px; padding: 2px 8px; border-bottom-left-radius: 8px; border-top-right-radius: 8px; font-weight: bold; }
  .pb-card__title { font-weight: bold; font-size: 15px; margin-bottom: 4px; }
  .pb-card__desc { font-size: 12px; color: #555; }
  .pb-card__price { margin-top: 8px; font-weight: bold; color: {{ section.settings.sale_badge_bg }}; }

  .pb-atc-btn {
    width: 100%; padding: 16px; background: {{ section.settings.atc_bg }}; color: {{ section.settings.atc_text }};
    border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer;
    transition: opacity 0.2s; margin-top: 15px; text-transform: uppercase; letter-spacing: 1px;
  }
  .pb-atc-btn:hover { opacity: 0.9; }

  /* --- Shipping Bar --- */
  .shipbar { display: flex; align-items: center; gap: 15px; padding: 12px; border-radius: 8px; margin: 15px 0; font-size: 13px; border: 1px solid rgba(255,255,255,0.1); }
  @media screen and (max-width: 750px){ .shipbar{ flex-direction: column; align-items: flex-start; } }
  .shipbar__label { font-weight: 700; white-space: nowrap; color: #D2F1E3; }
  .shipbar__value { font-weight: 500; font-size: 15px; color: #fff; margin-left: 5px; }
  .shipbar__list { display: flex; gap: 15px; flex-wrap: wrap; }
  .shipbar__item { display: flex; align-items: center; gap: 5px; color: #ccc; }

  /* --- Accordion --- */
  .pfaq-item { border-bottom: 1px solid rgba(255,255,255,0.15); }
  .pfaq-head { width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 15px 0; background: none; border: none; color: inherit; cursor: pointer; text-align: left; font-size: 16px; font-weight: 500; }
  .pfaq-body { padding-bottom: 15px; color: rgba(255,255,255,0.8); }

  /* --- Impact Note --- */
  .impact-note { display: flex; align-items: center; border-radius: 12px; overflow: hidden; margin: 20px 0; }
  .impact-note__icon { display: flex; align-items: center; justify-content: center; padding: 15px; border-right: 1px solid rgba(255,255,255,0.1); }
  .impact-note__text { padding: 20px; flex: 1; font-size: 14px; line-height: 1.5; margin: 0; }

  /* --- Scrolling Icons --- */
  .pf-wrap { margin: 20px 0; }
  .pf-track { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
  .pf-track::-webkit-scrollbar { display: none; }
  .pf-item { min-width: 80px; text-align: center; flex: 0 0 auto; }
  .pf-icon img { margin: 0 auto; display: block; width: 40px; height: 40px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); padding: 8px; object-fit: contain;}
  .pf-text { font-size: 11px; margin-top: 8px; color: inherit; line-height: 1.2; }
  .pf-progress { height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 10px; overflow: hidden; display: none; }
  .pf-bar { height: 100%; background: {{ section.settings.text_color }}; width: 0%; transition: width 0.1s; }
  @media (max-width: 768px) { .pf-progress { display: block; } }

  /* --- Sticky ATC --- */
  .sticky-cta {
    position: fixed; bottom: 20px; right: 20px; background: #121212; color: #fff; 
    padding: 12px; border-radius: 12px; z-index: 999; display: flex; gap: 15px; align-items: center; 
    box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform: translateY(150%); transition: transform 0.3s ease;
    max-width: 400px; width: calc(100% - 40px);
  }
  .sticky-cta.is-visible { transform: translateY(0); }
  @media (max-width: 750px) {
    .sticky-cta { bottom: 0; right: 0; left: 0; width: 100%; max-width: none; border-radius: 0; padding: 15px; }
    .sticky-cta__img, .sticky-cta__text { display: none; }
    .sticky-cta__btn { width: 100%; }
  }

  /* --- Upsells --- */
  .upsell-card { display: flex; background: #fff; border-radius: 10px; padding: 10px; gap: 15px; align-items: center; color: #121212; margin-bottom: 10px; }
  .upsell-card__media { width: 80px; height: 80px; flex-shrink: 0; }
  .upsell-card__media img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }
  .upsell-card__main { flex: 1; }
  .upsell-card__name { font-size: 14px; font-weight: 600; margin: 0 0 5px; color: #000; }
  .upsell-price-with-button { display: flex; justify-content: space-between; align-items: center; }
  .upsell-card__price { font-size: 16px; font-weight: 600; color: #000; }
  .upsell-card__atc { background: #A3835F; color: #fff; border: none; padding: 6px 14px; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px; }

  /* --- Advanced Tabs --- */
  .pit-tabs { display: grid; grid-template-columns: repeat(3, 1fr); border-bottom: 1px solid rgba(255,255,255,0.2); margin-bottom: 20px; }
  .pit-tab { background: transparent; border: none; padding: 15px 5px; cursor: pointer; color: inherit; opacity: 0.6; font-size: 14px; font-weight: 500; position: relative; }
  .pit-tab.is-active { opacity: 1; }
  .pit-underline { height: 2px; width: 100%; background: #fff; position: absolute; bottom: 0; opacity: 0; transition: 0.3s; }
  .pit-tab.is-active .pit-underline { opacity: 1; }
  .pit-panel { display: none; }
  .pit-panel.is-active { display: block; animation: fadeIn 0.5s; }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

  /* Size Guide Modal */
  .sg-modal { position: fixed; inset: 0; z-index: 99999; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); }
  .sg-modal.is-open { display: flex; }
  .sg-content { background: #fff; padding: 30px; border-radius: 12px; position: relative; max-width: 600px; width: 90%; color: #000; }
  .sg-switch-wrap { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; justify-content: flex-end; }
  .sg-btn-switch { padding: 5px 10px; border: 1px solid #000; background: #fff; cursor: pointer; font-size: 12px; border-radius: 4px; }
  .sg-btn-switch.active { background: #000; color: #fff; }

{%- endstyle -%}

<script src="{{ 'product-info.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>

<section id="MainProduct-{{ section.id }}" class="section-{{ section.id }}-padding" data-section="{{ section.id }}">
  <div class="page-width">
    <div class="product product--{{ section.settings.media_size }} product--{{ section.settings.media_position }} product--{{ section.settings.gallery_layout }} grid grid--1-col {% if product.media.size > 0 %}grid--2-col-tablet{% else %}product--no-media{% endif %}">
      
      <div class="grid__item product__media-wrapper">
        {% render 'product-media-gallery', variant_images: variant_images %}
      </div>

      <div class="product__info-wrapper grid__item">
        <product-info id="ProductInfo-{{ section.id }}" class="product__info-container{% if section.settings.enable_sticky_info %} product__column-sticky{% endif %}">
          
          {%- for block in section.blocks -%}
            {%- case block.type -%}
              
              {%- when '@app' -%}
                {% render block %}

              {%- when 'text' -%}
                <p class="product__text inline-richtext" style="color: {{ block.settings.color }}; margin-bottom: {{ block.settings.margin_bottom }}px; letter-spacing: 0.5px; text-transform: {{ block.settings.text_style }};" {{ block.shopify_attributes }}>
                  {{ block.settings.text }}
                </p>

              {%- when 'title' -%}
                <h1 class="product__title" {{ block.shopify_attributes }} style="margin-bottom: 10px;">
                  {{ product.title | escape }}
                </h1>

              {%- when 'review_highlights' -%}
                <div class="rh-wrap" {{ block.shopify_attributes }}>
                  <div class="rh-stars">
                    {% for i in (1..5) %}<svg viewBox="0 0 14 14" fill="currentColor"><path d="M7 0L8.57 5H14L9.5 8.2L11.1 14L7 10.5L2.9 14L4.5 8.2L0 5H5.43L7 0Z"/></svg>{% endfor %}
                  </div>
                  <div class="rh-head">
                    {% if block.settings.avatar != blank %}
                      <img class="rh-avatar" src="{{ block.settings.avatar | image_url: width: 80 }}">
                    {% endif %}
                    <div>
                      <div class="rh-name">{{ block.settings.author }}</div>
                      <div class="rh-role">{{ block.settings.role }}</div>
                    </div>
                  </div>
                  <p class="rh-text">"{{ block.settings.text }}"</p>
                </div>

              {%- when 'price' -%}
                <div class="no-js-hidden" id="price-{{ section.id }}" role="status" {{ block.shopify_attributes }}>
                  {%- if block.settings.show_description -%}
                    <div class="description_ctm" style="margin-bottom: 15px; opacity: 0.8;">{{ product.description | strip_html | truncatewords: 25 }}</div>
                  {%- endif -%}
                  
                  <div class="price-wrapper">
                    <div class="ctm-price__row">
                      {%- if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price -%}
                        <s class="ctm-price__compare">{{ product.selected_or_first_available_variant.compare_at_price | money }}</s>
                      {%- endif -%}
                      <span class="ctm-price__current">{{ product.selected_or_first_available_variant.price | money }}</span>
                      {%- if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price -%}
                        <span class="ctm-price__save">{{ block.settings.sale_badge_text }}</span>
                      {%- endif -%}
                    </div>
                  </div>
                </div>

              {%- when 'benefits_grid' -%}
                <div class="benefits-grid" id="benefits-{{ block.id }}" {{ block.shopify_attributes }}>
                  <style>
                    #benefits-{{ block.id }} { margin: 24px 0; color: {{ block.settings.text_color }}; }
                    #benefits-{{ block.id }} .benefits-grid__list { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
                    #benefits-{{ block.id }} .benefits-grid__item { display: flex; align-items: center; gap: 10px; }
                    #benefits-{{ block.id }} img, #benefits-{{ block.id }} svg { width: 24px; height: 24px; }
                    #benefits-{{ block.id }} p { margin: 0; font-size: 13px; line-height: 1.3; }
                    #benefits-{{ block.id }} strong { color: #fff; }
                  </style>
                  <div class="benefits-grid__list">
                    {% for i in (1..4) %}
                      {% capture icon_key %}icon_{{ i }}{% endcapture %}
                      {% capture text_key %}text_{{ i }}{% endcapture %}
                      {% if block.settings[text_key] != blank %}
                      <div class="benefits-grid__item">
                        <div class="benefits-grid__icon">
                          {% if block.settings[icon_key] != blank %}
                            <img src="{{ block.settings[icon_key] | image_url: width: 48 }}" width="24" height="24" loading="lazy">
                          {% else %}
                             <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/><path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                          {% endif %}
                        </div>
                        <div class="benefits-grid__text">{{ block.settings[text_key] }}</div>
                      </div>
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>

              {%- when 'scrolling_icons' -%}
                <div id="pf-icons-{{ block.id }}" class="pf-wrap" style="color:{{ block.settings.text_color }}" {{ block.shopify_attributes }}>
                  <div class="pf-track" id="pf-track-{{ block.id }}">
                    {% for i in (1..8) %}
                      {% capture icon_key %}icon_{{ i }}{% endcapture %}
                      {% capture label_key %}label_{{ i }}{% endcapture %}
                      {% if block.settings[label_key] != blank %}
                        <div class="pf-item">
                          <div class="pf-icon">
                            {% if block.settings[icon_key] != blank %}
                              <img src="{{ block.settings[icon_key] | image_url: width: 80 }}" width="40" height="40" loading="lazy">
                            {% else %}
                              <img src="https://cdn.shopify.com/s/files/1/0628/3503/files/check-mark.svg?v=1666191763" width="40" height="40">
                            {% endif %}
                          </div>
                          <div class="pf-text">{{ block.settings[label_key] }}</div>
                        </div>
                      {% endif %}
                    {% endfor %}
                  </div>
                  <div class="pf-progress">
                    <div class="pf-bar" id="pf-bar-{{ block.id }}"></div>
                  </div>
                  <script>
                    (function(){
                      const track = document.getElementById('pf-track-{{ block.id }}');
                      const bar = document.getElementById('pf-bar-{{ block.id }}');
                      if(track && bar){
                        track.addEventListener('scroll', function(){
                          const scrollLeft = track.scrollLeft;
                          const maxScroll = track.scrollWidth - track.clientWidth;
                          const width = (scrollLeft / maxScroll) * 100;
                          bar.style.width = width + '%';
                        });
                      }
                    })();
                  </script>
                </div>

              {%- when 'bundle_widget' -%}
                <div id="pb-bundles-{{ section.id }}" class="pb-wrap" {{ block.shopify_attributes }}>
                  
                  <div class="pb-sizes">
                    <div class="pb-sizes-head">
                      <label class="pb-label">{{ block.settings.size_label }}</label>
                      <button type="button" class="sbp-size-guide" onclick="toggleSizeGuide(true)" style="background:none; border:none; color: inherit; text-decoration: underline; cursor: pointer; padding: 0;">{{ block.settings.size_guide_text }}</button>
                    </div>
                    
                    <div class="pb-size-tabs">
                      {% assign shown_options = "" %}
                      {% for variant in product.variants %}
                        {% unless shown_options contains variant.option1 %}
                          <div class="pb-size-tab {% if product.selected_or_first_available_variant.option1 == variant.option1 %}is-active{% endif %}" 
                               data-variant-id="{{ variant.id }}"
                               data-price="{{ variant.price | money }}"
                               data-media-id="{{ variant.featured_media.id }}"
                               onclick="updateBundleVariant(this)">
                            {{ variant.option1 }}
                          </div>
                          {% assign shown_options = shown_options | append: variant.option1 | append: "|" %}
                        {% endunless %}
                      {% endfor %}
                    </div>
                  </div>

                  {% if block.settings.enable_bundles %}
                    <div class="pb-title" style="margin: 20px 0 10px; font-weight:500;">{{ block.settings.bundles_heading }}</div>
                    
                    {%- for i in (1..3) -%}
                      {%- capture prod_setting -%}bundle_product_{{ i }}{%- endcapture -%}
                      {%- capture title_setting -%}bundle_title_{{ i }}{%- endcapture -%}
                      {%- capture desc_setting -%}bundle_desc_{{ i }}{%- endcapture -%}
                      {%- capture badge_setting -%}bundle_badge_{{ i }}{%- endcapture -%}
                      
                      {%- assign b_prod = all_products[block.settings[prod_setting]] -%}
                      
                      {%- if b_prod != empty -%}
                        <div class="pb-card" onclick="selectBundle(this, '{{ b_prod.selected_or_first_available_variant.id }}', '{{ b_prod.price | money }}', '{{ b_prod.featured_media.id }}')">
                          {% if block.settings[badge_setting] != blank %}
                            <span class="pb-card__badge">{{ block.settings[badge_setting] }}</span>
                          {% endif %}
                          <div class="pb-card__title">{{ block.settings[title_setting] | default: b_prod.title }}</div>
                          <div class="pb-card__desc">{{ block.settings[desc_setting] }}</div>
                          <div class="pb-card__price">
                            {{ b_prod.price | money }} 
                            {% if b_prod.compare_at_price > b_prod.price %}
                              <s style="opacity:0.7; font-size:0.9em; margin-left:5px;">{{ b_prod.compare_at_price | money }}</s>
                            {% endif %}
                          </div>
                        </div>
                      {%- endif -%}
                    {%- endfor -%}
                  {% endif %}
                  
                  <div class="pb-atc-wrap">
                    <form method="post" action="/cart/add" class="product-form" id="product-form-{{ section.id }}">
                      <input type="hidden" name="id" id="bundle-variant-input" value="{{ product.selected_or_first_available_variant.id }}">
                      <button type="submit" class="pb-atc-btn" id="bundle-atc-btn">
                        {{ 'products.product.add_to_cart' | t }} - <span id="bundle-price-display">{{ product.selected_or_first_available_variant.price | money }}</span>
                      </button>
                    </form>
                  </div>
                  
                  <div class="secure-checkout" style="margin-top:15px; text-align:center;">
                    <div class="secure-note" style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">
                      <span style="margin-right:5px">ðŸ”’</span> <span class="guarantee-text">{{ block.settings.guarantee_text }}</span>
                    </div>
                    <div class="pay-badges" style="display: flex; justify-content: center; gap: 5px;">
                      {% for type in shop.enabled_payment_types %}
                        {{ type | payment_type_svg_tag: class: 'icon icon--full-color', style: 'width: 38px;' }}
                      {% endfor %}
                    </div>
                  </div>
                </div>
                
                <script>
                  function updateBundleVariant(element) {
                    document.querySelectorAll('.pb-size-tab').forEach(el => el.classList.remove('is-active'));
                    document.querySelectorAll('.pb-card').forEach(el => el.classList.remove('active'));
                    element.classList.add('is-active');
                    
                    const id = element.dataset.variantId;
                    const price = element.dataset.price;
                    const mediaId = element.dataset.mediaId;

                    document.getElementById('bundle-variant-input').value = id;
                    document.getElementById('bundle-price-display').innerText = price;

                    if (mediaId && window.goToMedia) {
                      window.goToMedia(mediaId);
                    }
                  }

                  function selectBundle(element, id, price, mediaId) {
                    document.querySelectorAll('.pb-size-tab').forEach(el => el.classList.remove('is-active'));
                    document.querySelectorAll('.pb-card').forEach(el => el.classList.remove('active'));
                    element.classList.add('active');
                    
                    document.getElementById('bundle-variant-input').value = id;
                    document.getElementById('bundle-price-display').innerText = price;
                    
                    if (mediaId && window.goToMedia) {
                      window.goToMedia(mediaId);
                    }
                  }
                </script>

              {%- when 'shipping_bar' -%}
                <div class="shipbar" style="background: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }};" {{ block.shopify_attributes }}>
                  <div style="padding: 0 15px; border-right: 1px solid rgba(255,255,255,0.1);">
                    <div class="shipbar__label">{{ block.settings.alert_text }}</div>
                    <div class="shipbar__value" id="dynamic-ship-date">Jan 2nd</div>
                  </div>
                  <div class="shipbar__list">
                    {% if block.settings.text_1 != blank %}
                    <div class="shipbar__item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                      <span>{{ block.settings.text_1 }}</span>
                    </div>
                    {% endif %}
                    {% if block.settings.text_2 != blank %}
                    <div class="shipbar__item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                      <span>{{ block.settings.text_2 }}</span>
                    </div>
                    {% endif %}
                  </div>
                </div>
                <script>
                  // Simple Date Logic for Shipping Bar
                  const date = new Date();
                  date.setDate(date.getDate() + 3); // Adds 3 days
                  const options = { month: 'short', day: 'numeric' };
                  document.getElementById('dynamic-ship-date').innerText = date.toLocaleDateString('en-US', options);
                </script>

              {%- when 'info_tabs' -%}
                <div class="pit" id="product-info-tabs-{{ block.id }}" {{ block.shopify_attributes }}>
                  <div class="pit-tabs" role="tablist">
                    <button class="pit-tab is-active" role="tab" onclick="openPitTab(event, 'panel-1-{{ block.id }}', '{{ block.id }}')">
                      {{ block.settings.tab_1_label }} <span class="pit-underline"></span>
                    </button>
                    <button class="pit-tab" role="tab" onclick="openPitTab(event, 'panel-2-{{ block.id }}', '{{ block.id }}')">
                      {{ block.settings.tab_2_label }} <span class="pit-underline"></span>
                    </button>
                    <button class="pit-tab" role="tab" onclick="openPitTab(event, 'panel-3-{{ block.id }}', '{{ block.id }}')">
                      {{ block.settings.tab_3_label }} <span class="pit-underline"></span>
                    </button>
                  </div>
                  <div class="pit-panels">
                    <div id="panel-1-{{ block.id }}" class="pit-panel is-active">
                      <div class="pit-copy">{{ block.settings.tab_1_content }}</div>
                      {% if block.settings.tab_1_image != blank %}<img src="{{ block.settings.tab_1_image | image_url: width: 600 }}" style="width:100%; border-radius:8px;">{% endif %}
                    </div>
                    <div id="panel-2-{{ block.id }}" class="pit-panel">
                      {% if block.settings.tab_2_image != blank %}<img src="{{ block.settings.tab_2_image | image_url: width: 1200 }}" style="width:100%; border-radius:8px;">{% endif %}
                    </div>
                    <div id="panel-3-{{ block.id }}" class="pit-panel">
                      <h3>{{ block.settings.tab_3_heading }}</h3>
                      <div class="pit-copy">{{ block.settings.tab_3_content }}</div>
                    </div>
                  </div>
                </div>
                <script>
                  function openPitTab(evt, panelId, blockId) {
                    var container = document.getElementById('product-info-tabs-' + blockId);
                    var panels = container.getElementsByClassName("pit-panel");
                    for (var i = 0; i < panels.length; i++) { panels[i].classList.remove("is-active"); }
                    var tabs = container.getElementsByClassName("pit-tab");
                    for (var i = 0; i < tabs.length; i++) { tabs[i].classList.remove("is-active"); }
                    document.getElementById(panelId).classList.add("is-active");
                    evt.currentTarget.classList.add("is-active");
                  }
                </script>

              {%- when 'accordion' -%}
                <div class="pfaq-item" {{ block.shopify_attributes }}>
                  <details>
                    <summary class="pfaq-head">
                      <span class="pfaq-left" style="display: flex; gap: 12px; align-items: center;">
                        {% if block.settings.icon != blank %}<img src="{{ block.settings.icon | image_url: width: 24 }}" width="24" height="24">{% endif %}
                        <span class="pfaq-title">{{ block.settings.heading }}</span>
                      </span>
                      <span class="pfaq-plus">+</span>
                    </summary>
                    <div class="pfaq-body rte">{{ block.settings.content }}</div>
                  </details>
                </div>

              {%- when 'impact_note' -%}
                <div id="impact-note-{{ block.id }}" class="impact-note" style="background: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }};" {{ block.shopify_attributes }}>
                  <div class="impact-note__icon">
                    {% if block.settings.icon != blank %}<img src="{{ block.settings.icon | image_url: width: 64 }}" width="64" height="64">{% else %}ðŸŒ¿{% endif %}
                  </div>
                  <p class="impact-note__text">{{ block.settings.text }}</p>
                </div>

              {%- when 'upsells' -%}
                <div class="upsell-two" {{ block.shopify_attributes }}>
                  <h3 class="upsell-two__title">{{ block.settings.title }}</h3>
                  {% for i in (1..2) %}
                    {% capture prod_key %}product_{{ i }}{% endcapture %}
                    {% assign up_prod = all_products[block.settings[prod_key]] %}
                    {% if up_prod != empty %}
                    <div class="upsell-card">
                      <div class="upsell-card__media"><img src="{{ up_prod.featured_image | image_url: width: 200 }}" loading="lazy"></div>
                      <div class="upsell-card__main">
                        <h4 class="upsell-card__name">{{ up_prod.title }}</h4>
                        <div class="upsell-price-with-button">
                          <div class="upsell-card__price"><span class="upsell-card__sale">{{ up_prod.price | money }}</span></div>
                          <form method="post" action="/cart/add">
                            <input type="hidden" name="id" value="{{ up_prod.selected_or_first_available_variant.id }}">
                            <button type="submit" class="upsell-card__atc">Add</button>
                          </form>
                        </div>
                      </div>
                    </div>
                    {% endif %}
                  {% endfor %}
                </div>

            {%- endcase -%}
          {%- endfor -%}

        </product-info>
      </div>
    </div>
  </div>

  {% for block in section.blocks %}
    {% if block.type == 'sticky_atc' %}
      <div id="sticky-cta-{{ section.id }}" class="sticky-cta">
        <div class="sticky-cta__img" style="width:50px; height:50px; flex-shrink:0;">
          <img src="{{ product.featured_image | image_url: width: 60 }}" width="50" height="50" style="border-radius: 8px; display:block; object-fit:cover;">
        </div>
        <div class="sticky-cta__text" style="flex:1;">
          <div style="font-weight: bold; font-size: 13px;">{{ product.title | truncate: 30 }}</div>
          <div style="color: #e23223; font-size: 11px; font-weight: bold; text-transform: uppercase;">{{ block.settings.alert_text }}</div>
        </div>
        <button class="sticky-cta__btn" onclick="document.querySelector('.pb-atc-btn').click()" style="background: #fff; color: #000; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer;">
          {{ block.settings.btn_text }}
        </button>
      </div>
      <script>
        window.addEventListener('scroll', function() {
          const sticky = document.getElementById('sticky-cta-{{ section.id }}');
          if(window.scrollY > 600) { sticky.classList.add('is-visible'); } else { sticky.classList.remove('is-visible'); }
        });
      </script>
    {% endif %}
  {% endfor %}

  <div id="sg-modal" class="sg-modal">
    <div class="sg-content">
       <button type="button" onclick="toggleSizeGuide(false)" style="position: absolute; right: 15px; top: 15px; background: none; border: none; font-size: 20px; cursor: pointer; color: #000;">âœ•</button>
       <h2 style="margin-top:0; color:#000;">Size Guide</h2>
       <div class="sg-switch-wrap">
         <button class="sg-btn-switch active" onclick="switchUnit('in')">IN</button>
         <button class="sg-btn-switch" onclick="switchUnit('cm')">CM</button>
       </div>
       <img src="https://cdn.shopify.com/s/files/1/0742/4635/7257/files/Frame_1171274894.png?v=1756269962" style="width:100%; height:auto; margin-bottom:15px; border-radius: 8px;">
       <table style="width:100%; border-collapse: collapse; font-size: 14px;" id="sg-table-in">
         <tr style="background:#f4f4f4;"><th style="padding:10px; border:1px solid #eee;">Size</th><th style="padding:10px; border:1px solid #eee;">Diameter</th><th style="padding:10px; border:1px solid #eee;">Length</th></tr>
         <tr><td style="padding:10px; border:1px solid #eee;">Mini</td><td style="padding:10px; border:1px solid #eee;">9.5"</td><td style="padding:10px; border:1px solid #eee;">18.5"</td></tr>
         <tr><td style="padding:10px; border:1px solid #eee;">Standard</td><td style="padding:10px; border:1px solid #eee;">10.2"</td><td style="padding:10px; border:1px solid #eee;">18.9"</td></tr>
       </table>
       <table style="width:100%; border-collapse: collapse; font-size: 14px; display:none;" id="sg-table-cm">
         <tr style="background:#f4f4f4;"><th style="padding:10px; border:1px solid #eee;">Size</th><th style="padding:10px; border:1px solid #eee;">Diameter</th><th style="padding:10px; border:1px solid #eee;">Length</th></tr>
         <tr><td style="padding:10px; border:1px solid #eee;">Mini</td><td style="padding:10px; border:1px solid #eee;">24 cm</td><td style="padding:10px; border:1px solid #eee;">47 cm</td></tr>
         <tr><td style="padding:10px; border:1px solid #eee;">Standard</td><td style="padding:10px; border:1px solid #eee;">26 cm</td><td style="padding:10px; border:1px solid #eee;">48 cm</td></tr>
       </table>
    </div>
  </div>

  <script>
    function toggleSizeGuide(show) {
      const modal = document.getElementById('sg-modal');
      if (modal) modal.style.display = show ? 'flex' : 'none';
    }
    function switchUnit(unit) {
      document.querySelectorAll('.sg-btn-switch').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('sg-table-in').style.display = unit === 'in' ? 'table' : 'none';
      document.getElementById('sg-table-cm').style.display = unit === 'cm' ? 'table' : 'none';
    }
    document.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('sg-modal');
      if(modal) { modal.addEventListener('click', function(e) { if (e.target === modal) toggleSizeGuide(false); }); }
    });
  </script>

</section>

{% schema %}
{
  "name": "Main Product Competitor",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "color", "id": "bg_color", "label": "Background Color", "default": "#121212" },
    { "type": "color_background", "id": "bg_gradient", "label": "Background Gradient", "default": "linear-gradient(90deg, #3b3e41 0%, #181a1b 100%)" },
    { "type": "color", "id": "text_color", "label": "Text Color", "default": "#ffffff" },
    { "type": "color", "id": "title_color", "label": "Title Color", "default": "#ffffff" },
    { "type": "color", "id": "price_color", "label": "Price Color", "default": "#E9E2D8" },
    { "type": "color", "id": "compare_price_color", "label": "Compare Price Color", "default": "#888888" },
    { "type": "color", "id": "sale_badge_bg", "label": "Sale Badge Background", "default": "#097350" },
    { "type": "color", "id": "sale_badge_text", "label": "Sale Badge Text", "default": "#E9E2D8" },
    { "type": "header", "content": "Bundle Widget" },
    { "type": "color", "id": "bundle_active_bg", "label": "Active Tab BG", "default": "#F6F4F0" },
    { "type": "color", "id": "bundle_border_color", "label": "Tab Border Color", "default": "#454545" },
    { "type": "color", "id": "atc_bg", "label": "ATC Button Background", "default": "#FFFFFF" },
    { "type": "color", "id": "atc_text", "label": "ATC Button Text", "default": "#121212" },
    { "type": "header", "content": "Media" },
    { "type": "select", "id": "media_size", "options": [ { "value": "small", "label": "Small" }, { "value": "medium", "label": "Medium" }, { "value": "large", "label": "Large" } ], "default": "large", "label": "Media Size" },
    { "type": "select", "id": "media_position", "options": [ { "value": "left", "label": "Left" }, { "value": "right", "label": "Right" } ], "default": "left", "label": "Media Position" },
    { "type": "select", "id": "gallery_layout", "options": [ { "value": "stacked", "label": "Stacked" }, { "value": "columns", "label": "Columns" }, { "value": "thumbnail", "label": "Thumbnails" }, { "value": "thumbnail_slider", "label": "Thumbnail Slider" } ], "default": "thumbnail_slider", "label": "Gallery Layout" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding Top", "default": 36 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding Bottom", "default": 36 }
  ],
  "blocks": [
    { "type": "@app" },
    {
      "type": "text",
      "name": "Text",
      "settings": [
        { "type": "text", "id": "text", "default": "Immaculate Performance", "label": "Text" },
        { "type": "color", "id": "color", "label": "Color", "default": "#B0B0B0" },
        { "type": "select", "id": "text_style", "options": [{ "value": "body", "label": "Body" }, { "value": "subtitle", "label": "Subtitle" }, { "value": "uppercase", "label": "Uppercase" }], "default": "body", "label": "Text Style" },
        { "type": "range", "id": "margin_bottom", "min": 0, "max": 50, "step": 2, "unit": "px", "label": "Margin Bottom", "default": 12 }
      ]
    },
    { "type": "title", "name": "Title", "limit": 1 },
    {
      "type": "price",
      "name": "Price",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "sale_badge_text", "label": "Sale Badge Text", "default": "SALE ENDS SOON!" },
        { "type": "checkbox", "id": "show_description", "label": "Show Short Description", "default": true }
      ]
    },
    {
      "type": "review_highlights",
      "name": "Review Highlights",
      "settings": [
        { "type": "image_picker", "id": "avatar", "label": "Avatar Image" },
        { "type": "text", "id": "author", "label": "Author Name", "default": "Dominique L." },
        { "type": "text", "id": "role", "label": "Role/Location", "default": "Michelin-Star Chef | Beverly Hills" },
        { "type": "textarea", "id": "text", "label": "Quote", "default": "This is a true kitchen workhorse. You get deep sear, caramelisation & flawless food release consistently." }
      ]
    },
    {
      "type": "benefits_grid",
      "name": "Benefits Grid (4 Icons)",
      "limit": 1,
      "settings": [
        { "type": "color", "id": "text_color", "label": "Text Color", "default": "#B0B0B0" },
        { "type": "image_picker", "id": "icon_1", "label": "Icon 1" }, { "type": "inline_richtext", "id": "text_1", "label": "Text 1", "default": "No PFAS, PTFE & PFOA." },
        { "type": "image_picker", "id": "icon_2", "label": "Icon 2" }, { "type": "inline_richtext", "id": "text_2", "label": "Text 2", "default": "Extreme Heat Resistant" },
        { "type": "image_picker", "id": "icon_3", "label": "Icon 3" }, { "type": "inline_richtext", "id": "text_3", "label": "Text 3", "default": "Non-Stick Surface" },
        { "type": "image_picker", "id": "icon_4", "label": "Icon 4" }, { "type": "inline_richtext", "id": "text_4", "label": "Text 4", "default": "Compatible With All Cooktops" }
      ]
    },
    {
      "type": "scrolling_icons",
      "name": "Scrolling Icons Bar",
      "settings": [
        { "type": "color", "id": "text_color", "label": "Text Color", "default": "#D4C7B4" },
        { "type": "image_picker", "id": "icon_1", "label": "Icon 1" }, { "type": "text", "id": "label_1", "label": "Label 1" },
        { "type": "image_picker", "id": "icon_2", "label": "Icon 2" }, { "type": "text", "id": "label_2", "label": "Label 2" },
        { "type": "image_picker", "id": "icon_3", "label": "Icon 3" }, { "type": "text", "id": "label_3", "label": "Label 3" },
        { "type": "image_picker", "id": "icon_4", "label": "Icon 4" }, { "type": "text", "id": "label_4", "label": "Label 4" },
        { "type": "image_picker", "id": "icon_5", "label": "Icon 5" }, { "type": "text", "id": "label_5", "label": "Label 5" },
        { "type": "image_picker", "id": "icon_6", "label": "Icon 6" }, { "type": "text", "id": "label_6", "label": "Label 6" },
        { "type": "image_picker", "id": "icon_7", "label": "Icon 7" }, { "type": "text", "id": "label_7", "label": "Label 7" },
        { "type": "image_picker", "id": "icon_8", "label": "Icon 8" }, { "type": "text", "id": "label_8", "label": "Label 8" }
      ]
    },
    {
      "type": "bundle_widget",
      "name": "Bundle / Variants",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "size_label", "label": "Label", "default": "Select Size Variant" },
        { "type": "text", "id": "size_guide_text", "label": "Guide Link Text", "default": "Size Guide" },
        { "type": "text", "id": "guarantee_text", "label": "Guarantee Text", "default": "Guaranteed Safe & Secure Checkout" },
        { "type": "header", "content": "Bundle Settings" },
        { "type": "checkbox", "id": "enable_bundles", "label": "Enable Bundle Cards", "default": true },
        { "type": "text", "id": "bundles_heading", "label": "Bundles Heading", "default": "Or Select Bundle & Save" },
        
        { "type": "header", "content": "Bundle 1" },
        { "type": "product", "id": "bundle_product_1", "label": "Product" },
        { "type": "text", "id": "bundle_title_1", "label": "Title Override" },
        { "type": "text", "id": "bundle_desc_1", "label": "Description", "default": "Includes Pan + Spatula." },
        { "type": "text", "id": "bundle_badge_1", "label": "Badge", "default": "Most Popular" },

        { "type": "header", "content": "Bundle 2" },
        { "type": "product", "id": "bundle_product_2", "label": "Product" },
        { "type": "text", "id": "bundle_title_2", "label": "Title Override" },
        { "type": "text", "id": "bundle_desc_2", "label": "Description", "default": "Great Value Set." },
        { "type": "text", "id": "bundle_badge_2", "label": "Badge", "default": "Best Value" },

        { "type": "header", "content": "Bundle 3" },
        { "type": "product", "id": "bundle_product_3", "label": "Product" },
        { "type": "text", "id": "bundle_title_3", "label": "Title Override" },
        { "type": "text", "id": "bundle_desc_3", "label": "Description", "default": "Ultimate Kitchen Set." },
        { "type": "text", "id": "bundle_badge_3", "label": "Badge" }
      ]
    },
    {
      "type": "shipping_bar",
      "name": "Shipping Bar",
      "settings": [
        { "type": "color", "id": "bg_color", "label": "Background Color", "default": "#03231A" },
        { "type": "color", "id": "text_color", "label": "Text Color", "default": "#D4C7B4" },
        { "type": "text", "id": "alert_text", "label": "Left Label", "default": "Ships By" },
        { "type": "text", "id": "text_1", "label": "Text 1", "default": "FREE Shipping & Easy Returns" },
        { "type": "text", "id": "text_2", "label": "Text 2", "default": "Lifetime Warranty" }
      ]
    },
    {
      "type": "info_tabs",
      "name": "Advanced Tabs (PIT)",
      "limit": 1,
      "settings": [
        { "type": "header", "content": "Tab 1 (Purity)" },
        { "type": "text", "id": "tab_1_label", "label": "Label", "default": "Purity Certification" },
        { "type": "richtext", "id": "tab_1_content", "label": "Description" },
        { "type": "image_picker", "id": "tab_1_image", "label": "Sticker Image" },
        { "type": "header", "content": "Tab 2 (Comparison)" },
        { "type": "text", "id": "tab_2_label", "label": "Label", "default": "Titanium Vs The Rest" },
        { "type": "image_picker", "id": "tab_2_image", "label": "Comparison Image" },
        { "type": "header", "content": "Tab 3 (Benefits)" },
        { "type": "text", "id": "tab_3_label", "label": "Label", "default": "Health Benefits" },
        { "type": "text", "id": "tab_3_heading", "label": "Heading", "default": "A New Standard in Safety." },
        { "type": "richtext", "id": "tab_3_content", "label": "List Items", "info": "Use Bold for titles." }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion Item",
      "settings": [
        { "type": "text", "id": "heading", "label": "Heading", "default": "Details, Care & Use" },
        { "type": "image_picker", "id": "icon", "label": "Icon" },
        { "type": "richtext", "id": "content", "label": "Content" }
      ]
    },
    {
      "type": "impact_note",
      "name": "Impact Note",
      "settings": [
        { "type": "color", "id": "bg_color", "label": "Background", "default": "#03231A" },
        { "type": "color", "id": "text_color", "label": "Text Color", "default": "#D4C7B4" },
        { "type": "image_picker", "id": "icon", "label": "Icon" },
        { "type": "textarea", "id": "text", "label": "Text", "default": "Part of your order helps create the future of toxin-free living." }
      ]
    },
    {
      "type": "upsells",
      "name": "Upsell Products",
      "settings": [
        { "type": "text", "id": "title", "label": "Heading", "default": "Complete Your Toxin-Free Kitchen" },
        { "type": "product", "id": "product_1", "label": "Product 1" },
        { "type": "product", "id": "product_2", "label": "Product 2" }
      ]
    },
    {
      "type": "sticky_atc",
      "name": "Sticky ATC",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "alert_text", "label": "Alert Text", "default": "ALMOST SOLD OUT" },
        { "type": "text", "id": "btn_text", "label": "Button Text", "default": "ADD TO CART" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Main Product Competitor",
      "blocks": [
        { "type": "title" },
        { "type": "review_highlights" },
        { "type": "price" },
        { "type": "benefits_grid" },
        { "type": "scrolling_icons" },
        { "type": "bundle_widget" },
        { "type": "shipping_bar" },
        { "type": "info_tabs" },
        { "type": "accordion" },
        { "type": "impact_note" },
        { "type": "upsells" }
      ]
    }
  ]
}
{% endschema %}