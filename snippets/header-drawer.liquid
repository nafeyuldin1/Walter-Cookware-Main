{% comment %}
  Renders the Custom Mobile Drawer (Grid Layout)
{% endcomment %}

<header-drawer data-breakpoint="{% if section.settings.menu_type_desktop == 'drawer' %}desktop{% else %}tablet{% endif %}">
  <details id="Details-menu-drawer-container" class="menu-drawer-container">
    
    <summary class="header__icon header__icon--menu header__icon--summary link focus-inset" aria-label="{{ 'sections.header.menu' | t }}">
      <span>
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none" class="icon icon-hamburger">
          <path d="M4 23H28M4 16H28M4 9H28" stroke="currentColor" stroke-width="2"/>
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none" class="icon icon-close" style="display:none;">
          <path d="M24 8L8 24M8 8L24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </span>
    </summary>
    
    <div id="menu-drawer" class="gradient menu-drawer motion-reduce color-{{ section.settings.menu_color_scheme }}">
      <div class="menu-drawer__inner-container">
        
        <div class="mm-drawer-head">
          <div class="mm-logo">
            {%- if settings.logo != blank -%}
              {{ settings.logo | image_url: width: 100 | image_tag }}
            {%- else -%}
              <span class="h4">{{ shop.name }}</span>
            {%- endif -%}
          </div>
          <button class="mm-close-btn" onclick="this.closest('details').removeAttribute('open')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
          </button>
        </div>

        <div class="mm-content-scroll">
          
          <div class="mm-notice">
            <span style="color: #888; font-size:12px; font-weight:600; letter-spacing:1px; text-transform: uppercase;">Categories</span>
          </div>

          <div class="mm-grid">
            {%- assign grid_blocks = section.blocks | where: "type", "mobile_icon" -%}
            
            {%- for block in grid_blocks -%}
              <a href="{{ block.settings.link }}" class="mm-grid-item">
                <div class="mm-item-icon">
                  {% if block.settings.icon != blank %}
                    <img src="{{ block.settings.icon | image_url: width: 100 }}" loading="lazy" width="50" height="50">
                  {% else %}
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
                  {% endif %}
                </div>
                <div class="mm-item-title">{{ block.settings.title }}</div>
                <div class="mm-item-arrow">â†’</div>
              </a>
            {%- endfor -%}
            
            {% if grid_blocks.size == 0 %}
              <p style="padding:20px; text-align:center; font-size:14px; color:#666;">
                Please add 'Mobile Grid Icon' blocks in the Header section customization.
              </p>
            {% endif %}
          </div>

          {%- assign footer_blocks = section.blocks | where: "type", "mobile_footer" -%}
          {%- for block in footer_blocks -%}
            <div class="mm-footer">
              <ul>
                {%- for link in block.settings.footer_menu.links -%}
                  <li><a href="{{ link.url }}">{{ link.title }}</a></li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endfor -%}

        </div>
      </div>
    </div>
  </details>
</header-drawer>

<style>
  /* DRAWER STYLES */
  .menu-drawer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: #fff;
    z-index: 1000;
    visibility: hidden;
    transform: translateX(-100%);
    transition: transform 0.3s ease, visibility 0.3s ease;
  }
  
  details[open] .menu-drawer {
    visibility: visible;
    transform: translateX(0);
  }

  .menu-drawer__inner-container {
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .mm-drawer-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    border-bottom: 1px solid #eee;
  }

  .mm-close-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
  }

  .mm-content-scroll {
    overflow-y: auto;
    padding: 20px;
    flex-grow: 1;
    padding-bottom: 100px;
  }

  .mm-notice {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* GRID SYSTEM */
  .mm-grid {
    display: grid;
    grid-template-columns: 1fr 1fr; /* 2 Columns */
    gap: 12px;
  }

  .mm-grid-item {
    background: #f8f8f8;
    border-radius: 12px;
    padding: 15px;
    text-decoration: none;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    position: relative;
    transition: background 0.2s;
  }

  .mm-grid-item:hover {
    background: #f0f0f0;
  }

  .mm-item-icon {
    width: 40px;
    height: 40px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .mm-item-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .mm-item-title {
    font-size: 14px;
    font-weight: 600;
    color: #000;
    line-height: 1.2;
    padding-right: 20px;
  }

  .mm-item-arrow {
    position: absolute;
    bottom: 15px;
    right: 15px;
    font-size: 16px;
    color: #ccc;
  }

  /* FOOTER LINKS */
  .mm-footer {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #eee;
  }
  
  .mm-footer ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
  }

  .mm-footer a {
    text-decoration: none;
    color: #555;
    font-size: 14px;
    font-weight: 500;
  }
</style>

<script>
  // Simple Toggle Logic for Drawer Icons visibility
  (function(){
    const details = document.getElementById('Details-menu-drawer-container');
    if(!details) return;
    const summary = details.querySelector('summary');
    const openIcon = summary.querySelector('.icon-hamburger');
    const closeIcon = summary.querySelector('.icon-close');

    summary.addEventListener('click', () => {
      // Small timeout to allow the 'open' attribute to update
      setTimeout(() => {
        if (details.hasAttribute('open')) {
          openIcon.style.display = 'none';
          closeIcon.style.display = 'block';
        } else {
          openIcon.style.display = 'block';
          closeIcon.style.display = 'none';
        }
      }, 50);
    });
  })();
</script>